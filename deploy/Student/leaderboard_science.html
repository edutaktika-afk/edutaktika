 <script>
    document.addEventListener("DOMContentLoaded", function() {
        firebase.auth().onAuthStateChanged(async function(user) {
            if (!user) {
                window.location.href = "logreg.html";
                return;
            }
            const uid = user.uid;
            const snapshot = await firebase.database().ref('students/' + uid).once('value');
            const student = snapshot.val();
            if (!student || student.role !== "student") {
                document.getElementById('mainContent').style.display = "none";
                alert("Access denied. Only students can access this page.");
                await firebase.auth().signOut();
                window.location.href = "logreg.html";
            } else {
                document.getElementById('mainContent').style.display = "block";
                // Load leaderboard after authentication is confirmed
                loadLeaderboard();
            }
        });
    });
    </script>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <title>Leaderboard</title>
    <link rel="stylesheet" href="../CSS/fonts.css">
<!-- ...inside <head> -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="../CSS/header.css">
    <link rel="stylesheet" href="../CSS/leaderboard.css">
    <link rel="stylesheet" href="../CSS/footer.css">
    <link rel="stylesheet" href="../CSS/burger.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* Add AFTER existing leaderboard table styles */
@media (max-width: 560px) {
  /* Hide Quiz (col 3) & Assessment (col 4), keep Rank, Player, Total, Badges */
  .leaderboard-table th:nth-child(3),
  .leaderboard-table td:nth-child(3),
  .leaderboard-table th:nth-child(4),
  .leaderboard-table td:nth-child(4) {
    display: none !important;
  }

  .leaderboard-table {
    table-layout: fixed;
    width: 100% !important;
    min-width: 0 !important;
  }

  .leaderboard-table th,
  .leaderboard-table td {
    padding: 6px 4px !important;
    font-size: .72rem !important;
    line-height: 1.1;
    white-space: nowrap;
  }

  /* Rank */
  .leaderboard-table th:nth-child(1),
  .leaderboard-table td:nth-child(1) {
    width: 42px;
  }

  /* Player cell */
  .leaderboard-table th:nth-child(2),
  .leaderboard-table td:nth-child(2) {
    width: 46%;
  }
  .player-cell {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .player-cell img {
    width: 30px;
    height: 30px;
  }
  .player-cell span {
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* Total */
  .leaderboard-table th:nth-child(5),
  .leaderboard-table td:nth-child(5) {
    width: 20%;
  }

  /* Badges */
  .leaderboard-table th:nth-child(6),
  .leaderboard-table td:nth-child(6) {
    width: 18%;
    text-align: center;
  }
}

/* Ultra narrow tweak */
@media (max-width: 400px) {
  .leaderboard-table th,
  .leaderboard-table td { font-size: .68rem !important; }
  .player-cell img { width: 26px; height: 26px; }
}
    </style>

</head>
<body>
    <div id="mainContent" style="display:none;">
       
        <!-- Burger icon for mobile -->
<button id="burgerBtn" class="burger-btn" aria-label="Open menu">
    <span></span>
    <span></span>
    <span></span>
</button>

        <header>
            <div class="floating-elements">
                <div class="floating-element"></div>
                <div class="floating-element"></div>
                <div class="floating-element"></div>
                <div class="floating-element"></div>
            </div>
            <div class="header-content">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <!-- Replace your logo-text div with this for per-letter bounce -->
                    <div class="logo-text">
                        <span>E</span><span>d</span><span>u</span><span>t</span><span>a</span><span>k</span><span>t</span><span>i</span><span>k</span><span>a</span>
                    </div>
                </div>
                <nav>
                    <ul>
                        <li><a href="homepage.html">Home</a></li>
                       <li class="dropdown">
                            <a href="#" class="dropbtn">Subject <i class="fa fa-caret-down"></i></a>
                            <ul class="dropdown-content">
                                <li><a href="subject_math.html">Math</a></li>
                                <li><a href="subject_english.html">English</a></li>
                                <li><a href="subject_science.html">Science</a></li>
                            </ul>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropbtn">Leaderboard <i class="fa fa-caret-down"></i></a>
                            <ul class="dropdown-content">
                                <li><a href="leaderboard_math.html">Math</a></li>
                                <li><a href="leaderboard_english.html">English</a></li>
                                <li><a href="leaderboard_science.html">Science</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#" id="profileBtn"><i class="fas fa-user-circle"></i> Profile</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Overlay for navbar -->
<div class="sidebar-overlay" id="navOverlay"></div>
<!-- Overlay for profile sidebar -->
<div class="sidebar-overlay" id="profileSidebarOverlay"></div>

     <!-- Profile Sidebar (Dynamic with Firebase) -->
<div id="profileSidebar" class="profile-sidebar">
    <div class="sidebar-content">
        <button class="close-btn" id="closeSidebar">&times;</button>
        <div style="position:relative; display:flex; flex-direction:column; align-items:center;">
            <img class="profile-avatar" id="profileAvatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=user" alt="Profile Avatar">
            <i class="fa-solid fa-star sidebar-star" style="position:absolute; bottom:0; right:10px; color:#ffd700; font-size:1.2rem; background:white; border-radius:50%; padding:2px 4px; box-shadow:0 1px 4px #ffd70044;"></i>
        </div>
        <div class="profile-name" id="profileName">Loading...</div>
        <br>
        <div class="profile-info" style="width:100%;max-width:260px;margin-bottom:24px;">
            <div class="profile-role" style="color:#2e8b57; font-weight:700; font-size:1.1rem; margin-bottom:8px; letter-spacing:1px; text-align:center;">
            Student
        </div>
            <div>
                <i class="fa-solid fa-id-badge" style="color:violet;margin-right:10px;"></i>
                <strong>ID:</strong> <span id="profileId">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#ff69b4;margin-right:10px;"></i>
                <strong>First Name:</strong> <span id="profileFirstName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#ffd700;margin-right:10px;"></i>
                <strong>Middle Name:</strong> <span id="profileMiddleName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#f14141;margin-right:10px;"></i>
                <strong>Last Name:</strong> <span id="profileLastName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-graduation-cap" style="color:#2e8b57;margin-right:10px;"></i>
                <strong>Grade Level:</strong> <span id="profileGrade">-</span>
            </div>
            <div>
                <i class="fa-solid fa-apple-whole" style="color:#4faaff;margin-right:10px;"></i>
                <strong>Section:</strong> <span id="profileSection">-</span>
            </div>
            <div>
    <i class="fas fa-map-marker-alt" style="color:#ff69b4;margin-right:10px;"></i>
    <strong>House/Street:</strong> <span id="profileAddressStreet">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#ffd700;margin-right:10px;"></i>
    <strong>Barangay:</strong> <span id="profileAddressBarangay">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#4faaff;margin-right:10px;"></i>
    <strong>City:</strong> <span id="profileAddressCity">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#2e8b57;margin-right:10px;"></i>
    <strong>Province:</strong> <span id="profileAddressProvince">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#f14141;margin-right:10px;"></i>
    <strong>ZIP:</strong> <span id="profileAddressZip">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:violet;margin-right:10px;"></i>
    <strong>Region:</strong> <span id="profileAddressRegion">-</span>
</div>
        </div>
        <div class="logout-switch-row">
            <div class="logout-switch" id="logoutSwitch">
                <div class="logout-switch-circle"></div>
            </div>
            <span class="logout-label" id="logoutLabel">LOGOUT</span>
        </div>
    </div>
</div>

<style>
    .profile-sidebar {
    margin-top: 20px;
    max-height: 95vh;
    overflow-y: auto;
    scrollbar-width: none;         /* Firefox */
    -ms-overflow-style: none;      /* IE and Edge */
}
.profile-sidebar::-webkit-scrollbar {
    display: none;                 /* Chrome, Safari, Opera */
}

</style>

            <!-- Firebase App (the core Firebase SDK) -->
            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
            <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

            

        <script src="../assets/js/Teacher Side/header.js"></script>

        <div class="leaderboard-container">
            <div class="leaderboard-title">ðŸŒŸ Science Leaderboard - Grade 5 ðŸŒŸ</div>
            <div class="leaderboard-desc">See who's on top this week! Play games, earn points, and climb the ranks!</div>
            <!-- Podium -->
            <div class="podium" id="podium"></div>
            <!-- Leaderboard Table -->
            <table class="leaderboard-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Player</th>
                        <th>Quiz Points</th>
                        <th>Assessment Points</th>
                        <th>Total</th>
                        <th>Badges</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Leaderboard rows will be inserted here -->
                </tbody>
            </table>
            <!-- Dynamic Pagination -->
            <div id="pagination" class="pagination" aria-label="Leaderboard pages"></div>
        </div>
        
        <script>
        const firebaseConfig = {
                apiKey: "AIzaSyB5BbeLLvPX8l1c4Lq0f-CmIUml4hQOQlE",
                authDomain: "edutaktika.firebaseapp.com",
                databaseURL: "https://edutaktika-default-rtdb.firebaseio.com",
                projectId: "edutaktika",
                storageBucket: "edutaktika.appspot.com",
                messagingSenderId: "676848575316",
                appId: "1:676848575316:web:f78f8c0f83bf3d9dfb5ec1",
                measurementId: "G-X3GT5TNN87"
            };
            // Removed legacy v8 firebase-app.js & firebase-database.js to prevent duplicate global definition
            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const auth = firebase.auth();
       

        // 2. Fetch and display leaderboard (Science subject only)
        async function loadLeaderboard() {
            console.log('Loading Science leaderboard...');
            // Get current user's grade level
            const currentUser = firebase.auth().currentUser;
            if (!currentUser) {
                console.log('No current user found');
                return;
            }
            console.log('Current user:', currentUser.uid);
            
            const userSnapshot = await db.ref('students/' + currentUser.uid).once('value');
            const userData = userSnapshot.val();
            const userGrade = userData ? userData.gradelevel : null;
            
            if (!userGrade) {
                console.error('Could not determine user grade level');
                console.log('User data:', userData);
                return;
            }
            console.log('User grade:', userGrade);
            
            // Update title to show current user's grade
            const titleEl = document.querySelector('.leaderboard-title');
            if (titleEl) {
                titleEl.textContent = `ðŸŒŸ Science Leaderboard - Grade ${userGrade} ðŸŒŸ`;
            }
            
            // Update page title
            document.title = `Science Leaderboard - Grade ${userGrade}`;
            
            // Base student snapshot
            const snapshot = await db.ref('students').once('value');
            let students = [];
            snapshot.forEach(child => {
                const s = child.val() || {};
                s._key = child.key;
                students.push(s);
            });
            console.log('Total students found:', students.length);

            // Calculate Science-specific scores
            students.forEach(s => {
                // Science quiz points - only from Science quizzes
                let scienceQuizPoints = 0;
                if (s.quizzes) {
                    Object.keys(s.quizzes).forEach(quizKey => {
                        // Only count Science-related quizzes
                        if (quizKey.includes('science') || quizKey.includes('science-quiz')) {
                            const summary = s.quizzes[quizKey]?.summary;
                            if (summary && typeof summary.best === 'number') {
                                console.log(`Found science quiz ${quizKey} with score:`, summary.best);
                                scienceQuizPoints += summary.best;
                            }
                        }
                    });
                }
                
                // Science assessment points - only from Science assessments
                let scienceAssessmentPoints = 0;
                if (s.assessments) {
                    Object.keys(s.assessments).forEach(aid => {
                        // Only count Science-related assessments
                        if (aid.includes('science') || aid === 'assessment3') {
                            const summary = s.assessments[aid]?.summary;
                            if (summary && typeof summary.best === 'number') {
                                scienceAssessmentPoints += summary.best;
                            }
                        }
                    });
                }
                
                s.quizPoints = scienceQuizPoints;
                s.assessmentPoints = scienceAssessmentPoints;
                s.combinedPoints = s.quizPoints + s.assessmentPoints;
            });

            // Filter for current user's grade level only
            students = students.filter(s => s.gradelevel == userGrade);
            console.log('Students after grade filter:', students.length);

            // Sort descending by combined, then assessment, then quiz, then name
            students.sort((a,b) => {
                // Primary sort: Combined points (descending)
                if (b.combinedPoints !== a.combinedPoints) return b.combinedPoints - a.combinedPoints;
                // Secondary sort: Assessment points (descending)
                if (b.assessmentPoints !== a.assessmentPoints) return b.assessmentPoints - a.assessmentPoints;
                // Tertiary sort: Quiz points (descending)
                if (b.quizPoints !== a.quizPoints) return b.quizPoints - a.quizPoints;
                // Final sort: Name (ascending)
                const nameA = ((a.fname||'') + ' ' + (a.lname||'')).trim();
                const nameB = ((b.fname||'') + ' ' + (b.lname||'')).trim();
                return nameA.localeCompare(nameB);
            });

            // Podium (top 3) based on combinedPoints
            const podiumIndices = [1, 0, 2]; // 2nd, 1st, 3rd visually
            const podiumClasses = ['silver', 'gold', 'bronze'];
            const podiumRanks = [2, 1, 3];
            let podiumHtml = '';
            podiumIndices.forEach((studentIdx, i) => {
                if (!students[studentIdx]) return;
                const student = students[studentIdx];
                const avatar = student.avatar ? student.avatar : `https://api.dicebear.com/7.x/bottts/svg?seed=${encodeURIComponent((student.fname||'') + (student.lname||''))}`;
                podiumHtml += `
                <div class="podium-place ${podiumClasses[i]}">
                    <div class="podium-rank">${podiumRanks[i]}</div>
                    <img src="${avatar}" class="avatar" alt="${student.fname||''}">
                    <div class="podium-name">${(student.fname||'') + ' ' + (student.lname||'')}</div>
                    <div class="podium-score">${student.combinedPoints} total</div>
                </div>`;
            });
            document.getElementById('podium').innerHTML = podiumHtml;

            applyLeaderboardPagination(students,{
  tbodyId:'leaderboard-body',
  paginationId:'pagination',
  rowsPerPage:10
});
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadLeaderboard();
        });
        </script>

<footer>
  <div class="footer-wrap">
    <div class="footer-col">
      <h4 class="footer-brand">Eduktaktika</h4>
      <p>Interactive, gameâ€‘based learning for Math, English, and Science.</p>
    </div>
    <div class="footer-col">
      <h4>Connect</h4>
      <ul class="footer-social">
        <li><a href="homepage.html">Homepage</a></li>
        <li><a href="studentlist.html">Student</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Subjects</h4>
      <ul class="footer-links">
        <li><a href="subject_math.html">Math</a></li>
        <li><a href="subject_english.html">English</a></li>
        <li><a href="subject_science.html">Science</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Leaderboards</h4>
      <ul class="footer-links">
        <li><a href="leaderboard_math.html">Math</a></li>
        <li><a href="leaderboard_english.html">English</a></li>
        <li><a href="leaderboard_science.html">Science</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-social-row">
      <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
      <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
      <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
    </div>
    <p>Â© 2025 Eduktaktika. All rights reserved.</p>
  </div>
</footer>
    <script src="../assets/js/Student Side/editProfile.js"></script>

    <style>
        nav ul {
        display: flex;
        align-items: center;
        padding: 0;
        margin: 0;
    }
    nav ul li {
        list-style: none;
        margin: 0 10px;
        position: relative;
        height: 100%;
        display: flex;
        align-items: center;
    }
    nav ul li a, nav ul li .dropbtn {
        display: flex;
        align-items: center;
        height: 48px; /* Match your nav height */
        line-height: 48px;
        padding: 0 18px;
        color: #2d3923;
        text-decoration: none;
        font-size: 1rem;
        background: none;
        border: none;
        cursor: pointer;
    }
    nav ul li .dropdown-content {
        display: none;
        position: absolute;
        background: #fff;
        min-width: 120px;
        box-shadow: 0 4px 16px #0002;
        z-index: 1000;
        border-radius: 8px;
        padding: 0;
        margin: 0;
        top: 100%;
        left: 0;
    }
    nav ul li .dropdown-content li {
        list-style: none;
        border-bottom: 1px solid #eee;
    }
    nav ul li .dropdown-content li:last-child {
        border-bottom: none;
    }
    nav ul li .dropdown-content a {
        color:  18px;
        color: #2d3923;
        padding: 10px 20px;
        display: block;
        text-decoration: none;
        border-radius: 0;
        transition: background 0.2s;
        height: auto;
        line-height: normal;
    }
    nav ul li .dropdown-content a:hover {
        background: #f0f0f0;
    }
    nav ul li.dropdown:hover .dropdown-content {
        display: block;
    }
    </style>

    <script>
    // Fetch and display student info in the profile sidebarh
    firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
            firebase.database().ref('students/' + user.uid).once('value').then(function(snapshot) {
                const data = snapshot.val();
                if (data) {
                    document.getElementById('profileName').textContent = (data.fname || '') + ' ' + (data.lname || '');
                    document.getElementById('profileId').textContent = data.id || user.uid;
                    document.getElementById('profileFirstName').textContent = data.fname || '';
                    document.getElementById('profileMiddleName').textContent = data.mname || '';
                    document.getElementById('profileLastName').textContent = data.lname || '';
                    document.getElementById('profileGrade').textContent = data.gradelevel || '-';
                    document.getElementById('profileSection').textContent = data.section || '-';
                    document.getElementById('profileAvatar').src = "https://api.dicebear.com/7.x/bottts/svg?seed=" + encodeURIComponent(data.fname || "student");
                }
                if (data.address) {
                    document.getElementById('profileAddressStreet').textContent = data.address.street || '-';
                    document.getElementById('profileAddressBarangay').textContent = data.address.barangay || '-';
                    document.getElementById('profileAddressCity').textContent = data.address.city || '-';
                    document.getElementById('profileAddressProvince').textContent = data.address.province || '-';
                    document.getElementById('profileAddressZip').textContent = data.address.zip || '-';
                    document.getElementById('profileAddressRegion').textContent = data.address.region || '-';
                }
                
            });
        }
    });
    </script>

    <script src="../assets/js/Student Side/profile.js"></script>

    <script src="../assets/js/navbar.js"></script>

    <!-- Add to each leaderboard page -->
<script src="../assets/js/leaderboardPagination.js"></script>
    </div>
</body>
</html>