<script>
document.addEventListener("DOMContentLoaded", function() {
    firebase.auth().onAuthStateChanged(async function(user) {
        if (!user) {
            window.location.href = "logreg.html";
            return;
        }
        const uid = user.uid;
        const snap = await firebase.database().ref('admins/' + uid).once('value');
        const admin = snap.val();
        if (!admin || admin.role !== "admin") {
            document.getElementById('mainContent').style.display = "none";
            alert("Access denied.");
            await firebase.auth().signOut();
            window.location.href = "logreg.html";
        } else {
            document.getElementById('mainContent').style.display = "block";
            // Show Gmail and role in the dropdown
            document.getElementById('adminEmail').textContent = admin.email || user.email;
            document.getElementById('adminUsername').textContent = '@' + (admin.role || 'admin');
        }
    });
});
</script>

<!DOCTYPE html>
<html>
<head>
    <title>Admin - Teacher Approvals</title>
        <link rel="stylesheet" href="../CSS/fonts.css">
<!-- ...inside <head> -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        table { border-collapse: collapse; width: 90%; margin: 30px auto; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
        th { background: #2e8b57;; color: #fff; }
        .approved { color: green; font-weight: bold; }
        .pending { color: orange; font-weight: bold; }
        button { padding: 6px 16px; border-radius: 6px; border: none; cursor: pointer; }
        .approve { background: #4f8cff; color: #fff; }
        .reject { background: #ffb6b9; color: #232946; }
        .delete { background: #e53935; color: #fff; }
        .review { background: #ffd700; color: #232946; }
        /* Modal styles */
        .modal-bg {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.4);
            align-items: center; justify-content: center;
        }
        .modal-box {
            background: #fff;
            border-radius: 16px;
            padding: 32px 36px;
            min-width: 320px;
            max-width: 95vw;
            box-shadow: 0 8px 32px #0003;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 12px; right: 18px;
            background: #eee;
            border: none;
            border-radius: 50%;
            width: 32px; height: 32px;
            font-size: 1.3rem;
            cursor: pointer;
        }
        .modal-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 18px;
            color: #4f8cff;
        }
        .modal-content div {
            margin-bottom: 10px;
            font-size: 1.07rem;
        }
        .modal-label {
            font-weight: bold;
            color: #232946;
        }
        /* Admin bar styles */
        .admin-bar {
            position: fixed;
            top: 0; right: 0;
            z-index: 1;
            padding: 0 32px 0 0;
            width: 100vw;
            height: 70px;
            background:#2e8b57;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            box-shadow: 0 2px 12px #0002;
        }
        .admin-dropdown {
            position: relative;
            display: inline-block;
        }
        .admin-icon-btn {
            background: #fff;
            border: none;
            border-radius: 50%;
            width: 54px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.1rem;
            color: #2e8b57;
            cursor: pointer;
            box-shadow: 0 2px 8px #ffd70055;
            transition: background 0.2s, box-shadow 0.2s;
        }
        .admin-icon-btn:hover {
            background: #ffd700;
            color: #232946;
            box-shadow: 0 4px 16px #4f8cff44;
        }
        .admin-dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            top: 62px;
            background: #fff;
            min-width: 220px;
            border-radius: 12px;
            box-shadow: 0 4px 24px #0002;
            padding: 18px 22px 12px 22px;
            z-index: 10001;
            text-align: left;
        }
        .admin-dropdown-content.show {
            display: block;
            animation: fadeIn 0.2s;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px);}
            to { opacity: 1; transform: translateY(0);}
        }
        .admin-dropdown-content .admin-email,
        .admin-dropdown-content .admin-username {
            font-size: 1.05rem;
            color: #232946;
            margin-bottom: 8px;
            word-break: break-all;
        }
        .admin-dropdown-content .admin-username {
            color: #4f8cff;
            font-weight: bold;
        }
        .admin-dropdown-content .logout-btn {
            width: 100%;
            background: #ffd700;
            color: rgb(0, 0, 0);
            border: none;
            padding: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1.08rem;
            margin-top: 10px;
            box-shadow: 0 2px 8px #ffd70044;
            letter-spacing: 1px;
            transition: background 0.2s, color 0.2s;
        }
        .admin-dropdown-content .logout-btn:hover {
            background: #ff0000;
            color: #ffffff;
        }
        body { padding-top: 80px; }

        /* Admin modal styles */
        .admin-modal-bg {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.35);
            align-items: center; justify-content: center;
        }
        .admin-modal-card {
            background: linear-gradient(180deg, #ffe6f7 0%, #e0eaff 100%);
            border-radius: 28px;
            box-shadow: 0 4px 24px rgba(79,140,255,0.10);
            max-width: 400px;
            width: 95%;
            padding: 36px 24px 24px 24px;
            text-align: center;
            position: relative;
            font-family: 'Baloo 2', cursive, Arial, sans-serif;
            animation: sidebarDrop 0.5s cubic-bezier(.77,0,.18,1);
        }
        .admin-modal-card .close-btn {
            position: absolute;
            top: 18px;
            right: 18px;
            background: none;
            border: none;
            font-size: 1.7rem;
            color: #ff69b4;
            cursor: pointer;
            transition: color 0.2s;
        }
        .admin-modal-card .close-btn:hover {
            color: #2e8b57;
        }
        .admin-modal-card .profile-info {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 10px;
            width: 100%;
            max-width: 420px;
            max-height: 420px;           /* Limit height for scroll */
            overflow-y: auto;            /* Make content scrollable */
            border-radius: 18px;         /* Add border radius */
            background: #f7f9fb;         /* Optional: subtle background for contrast */
            padding: 10px 0;             /* Optional: inner padding */
            scrollbar-width: none;         /* Firefox */
    -ms-overflow-style: none; 
        }
        .admin-modal-card .profile-info::-webkit-scrollbar {
    display: none;                 /* Chrome, Safari, Opera */
}
        .admin-modal-card .profile-info > div {
            display: flex;
            align-items: center;
            background: #fff;
            border-radius: 14px;
            box-shadow: 0 2px 8px #e0eaff33;
            padding: 7px 14px;
            width: 100%;
            gap: 8px;
            font-size: 1.05rem;
            color: #3f4d34;
            margin: 0 auto;
            flex-wrap: nowrap;
            min-height: 32px;
            overflow-x: auto; /* Allow horizontal scroll for long content */
        }
        .admin-modal-card .profile-info .modal-label {
            min-width: 110px;
            color: #4faaff;
            font-weight: 600;
            font-size: 1.08rem;
            flex-shrink: 0;
        }
        .admin-modal-card .profile-info span:not(.modal-label) {
            margin-left: 8px;
            font-weight: 600;
            color: #3f4d34;
            font-family: 'Baloo 2', cursive;
            white-space: nowrap;
            flex: 1 1 0;
            min-width: 0;
        }
        #teachersTable {
    background: #fff;
    border-radius: 18px;
    box-shadow: 0 4px 24px #0001;
    overflow: hidden;
}
#teachersTable th, #teachersTable td {
    border: none;
}
#teachersTable th {
    background: var(--primary, #2e8b57);
    color: #fff;
    font-size: 1.08rem;
    letter-spacing: 1px;
}
#teachersTable tbody tr {
    transition: background 0.18s;
}
#teachersTable tbody tr:hover {
    background: #e0ffe6;
}
#teachersTable td {
    background: #fff;
    font-size: 1.05rem;
    vertical-align: middle;
}

.review {
    font-weight: 600;
    border: none;
    background: #ffd700;
    color: #232946;
    border-radius: 8px;
    padding: 6px 18px;
    cursor: pointer;
    transition: background 0.18s;
}
.review:hover {
    background: #ff69b4;
    color: #fff;
}
/* Hide action buttons by default */
.action-btns button {
    display: none;
}

/* Show on hover of the Action cell */
td:hover .action-btns button {
    display: inline-block;
    margin: 0 2px;
}

.action-btns {
    position: relative;
    min-width: 120px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.action-btns .action-main {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    background: #ffd700;
    color: #232946;
    border-radius: 8px;
    padding: 7px 18px;
    font-weight: 700;
    font-size: 1.05rem;
    border: none;
    cursor: pointer;
    box-shadow: 0 2px 8px #ffd70033;
    transition: opacity 0.25s, transform 0.25s;
    z-index: 1;
    position: absolute;
    left: 50%; top: 50%;
    transform: translate(-50%, -50%);
    opacity: 1;
    pointer-events: auto;
}

.action-btns .approve,
.action-btns .reject {
    opacity: 0;
    pointer-events: none;
    transform: translateY(10px) scale(0.95);
    transition: opacity 0.25s, transform 0.25s;
    margin: 0 4px;
    font-size: 1.05rem;
    font-weight: 700;
    border-radius: 8px;
    border: none;
    box-shadow: 0 2px 8px #ffd70033;
    padding: 7px 16px;
}

.action-btns .approve {
    background: #4f8cff;
    color: #fff;
    border: 2px solid #4f8cff;
}
.action-btns .approve:hover {
    background: #ffd700;
    color: #232946;
    border-color: #ffd700;
}

.action-btns .reject {
    background: #ffb6b9;
    color: #232946;
    border: 2px solid #ffb6b9;
}
.action-btns .reject:hover {
    background: #ff2323;
    color: #fff;
    border-color: #ff2323;
}

/* On hover, hide Action button and show Approve/Reject smoothly */
td:hover .action-btns .action-main,
.action-btns:focus-within .action-main {
    opacity: 0;
    pointer-events: none;
    transform: translate(-50%, -50%) scale(0.95);
}

td:hover .action-btns .approve,
td:hover .action-btns .reject,
.action-btns:focus-within .approve,
.action-btns:focus-within .reject {
    opacity: 1;
    pointer-events: auto;
    transform: translateY(0) scale(1);
}

/* Optional: highlight Action cell on hover */
#teachersTable td:nth-child(8):hover {
    background: #fffbe6;
    box-shadow: 0 2px 12px #ffd70055;
    transition: background 0.2s, box-shadow 0.2s;
    position: relative;
    z-index: 2;
}
    </style>
</head>
<body>
    <div id="mainContent" style="display:none;">
    <!-- Admin bar with icon and dropdown -->
    <div class="admin-bar">
        <div class="admin-dropdown">
            <button class="admin-icon-btn" id="adminDropdownBtn" title="Admin">
                <i class="fas fa-user-shield"></i>
            </button>
            <div class="admin-dropdown-content" id="adminDropdownContent">
                <div class="admin-email" id="adminEmail">admin@email.com</div>
                <div class="admin-username" id="adminUsername">@admin</div>
                <button class="review" id="openAddAdminBtn" style="width:100%;margin-bottom:8px;">Add Admin</button>
                <button class="logout-btn" onclick="logoutAdmin()">Logout</button>
            </div>
        </div>
    </div>

    <h2 style="text-align:center;">Teacher Account Approvals</h2>
    <table id="teachersTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Grade Level</th>
                <th>Section</th>
                <th>Students</th> <!-- NEW COLUMN -->
                <th>Status</th>
                <th>Action</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            <!-- Rows will be inserted here by JS -->
        </tbody>
    </table>

    <!-- Modal for review -->
    <div class="admin-modal-bg" id="reviewModal">
        <div class="admin-modal-card">
            <button class="close-btn" onclick="closeReviewModal()">&times;</button>
            <div style="display:flex;flex-direction:column;align-items:center;">
                <img class="profile-avatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=teacher" alt="Teacher Avatar" style="width:80px;height:80px;border-radius:50%;border:3px solid #ffd700;margin-bottom:10px;">
            </div>
            <div class="profile-name" id="modalTeacherName" style="font-size:1.3em;font-family:'Baloo 2',cursive;color:#2e8b57;margin-bottom:2px;text-align:center;">Teacher Name</div>
            <div class="profile-role" style="color:#2e8b57;font-weight:700;font-size:1.05rem;margin-bottom:14px;letter-spacing:1px;text-align:center;">
                Teacher
            </div>
            <div class="profile-info" id="modalContent" style="width:100%;max-width:420px;margin:0 auto 0 auto;">
                <!-- Details will be filled by JS -->
            </div>
        </div>
    </div>

    <!-- Add AFTER the existing review modal (#reviewModal) -->
<div class="admin-modal-bg" id="adminCreatedModal" aria-hidden="true" role="dialog">
  <div class="admin-modal-card">
    <button class="close-btn" onclick="closeAdminCreatedModal()">&times;</button>
    <div class="modal-title">Admin Created</div>
    <div class="modal-content">
      <div id="adminCreatedText">The admin account has been created successfully.</div>
    </div>
    <button class="logout-btn" id="adminCreatedOk">OK</button>
  </div>
</div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
    // Your Firebase config
    const firebaseConfig = {
        apiKey: "AIzaSyB5BbeLLvPX8l1c4Lq0f-CmIUml4hQOQlE",
        authDomain: "edutaktika.firebaseapp.com",
        databaseURL: "https://edutaktika-default-rtdb.firebaseio.com",
        projectId: "edutaktika",
        storageBucket: "edutaktika.appspot.com",
        messagingSenderId: "676848575316",
        appId: "1:676848575316:web:f78f8c0f83bf3d9dfb5ec1",
        measurementId: "G-X3GT5TNN87"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Admin dropdown logic
    document.getElementById('adminDropdownBtn').onclick = function() {
        document.getElementById('adminDropdownContent').classList.toggle('show');
    };
    window.addEventListener('click', function(e) {
        if (!document.getElementById('adminDropdownBtn').contains(e.target) &&
            !document.getElementById('adminDropdownContent').contains(e.target)) {
            document.getElementById('adminDropdownContent').classList.remove('show');
        }
    });

    // Remove session check: anyone can view and interact
    document.getElementById('adminEmail').textContent = "admin@email.com";
    document.getElementById('adminUsername').textContent = "@admin";

    function logoutAdmin() {
        firebase.auth().signOut().then(() => {
            window.location.href = "logreg.html";
        });
    }

    // Load teachers from Firebase
function loadTeachers() {
    // Fetch all students first
    db.ref('students').once('value').then(studentSnap => {
        const students = [];
        studentSnap.forEach(child => {
            students.push(child.val());
        });

        // Then fetch all teachers
        db.ref('teachers').once('value').then(snapshot => {
            const tbody = document.querySelector('#teachersTable tbody');
            tbody.innerHTML = '';
            snapshot.forEach(child => {
                const t = child.val();
                // Count students in the same section as this teacher
                const studentCount = students.filter(s => s.section === t.section).length;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${t.id || ''}</td>
                    <td>
                        <button class="review" onclick="reviewTeacher('${child.key}')">${(t.fname || '') + ' ' + (t.lname || '')}</button>
                    </td>
                    <td>${t.email || ''}</td>
                    <td>${t.grade || ''}</td>
                    <td>${t.section || ''}</td>
                    <td>${studentCount}</td>
                    <td>
                        ${t.approved ? '<span class="approved">Approved</span>' : '<span class="pending">Pending</span>'}
                    </td>
                   <td>
                        <div class="action-btns">
                            ${!t.approved ? `
                                <button class="action-main" title="Take Action"><i class="fas fa-ellipsis-h"></i> Action</button>
                                <button class="approve" onclick="approveTeacher('${child.key}')">Approve</button>
                                <button class="reject" onclick="rejectTeacher('${child.key}')">Reject</button>
                            ` : '<span style="color:#aaa;">—</span>'}
                        </div>
                    </td>
                    <td>
                        <button class="delete" onclick="deleteTeacher('${child.key}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        });
    });
}

    // Approve teacher
    function approveTeacher(key) {
        const btn = document.querySelector(`button.approve[onclick="approveTeacher('${key}')"]`);
        const tr = btn ? btn.closest('tr') : null;

        db.ref('teachers/' + key).update({ 
            approved: true,
            approvedAt: new Date().toISOString()
        })
            .then(() => {
                if (tr) {
                    tr.querySelector('td:nth-child(6)').innerHTML = '<span class="approved">Approved</span>';
                    tr.querySelector('td:nth-child(7)').innerHTML = '<span style="color:#aaa;">—</span>';
                }
                alert('Teacher approved!');
            })
            .catch(err => alert('Error approving teacher: ' + err.message));
    }

    // Reject (delete) teacher
    function rejectTeacher(key) {
        if (confirm('Reject and delete this teacher?')) {
            db.ref('teachers/' + key).remove()
                .then(() => {
                    alert('Teacher rejected and deleted.');
                    loadTeachers();
                })
                .catch(err => alert('Error deleting teacher: ' + err.message));
        }
    }

    // Delete teacher (separate from reject, always available)
    function deleteTeacher(key) {
        if (confirm('Delete this teacher account?')) {
            db.ref('teachers/' + key).remove()
                .then(() => {
                    alert('Teacher deleted.');
                    loadTeachers();
                })
                .catch(err => alert('Error deleting teacher: ' + err.message));
        }
    }

    // Review teacher (show modal)
    function reviewTeacher(key) {
        db.ref('teachers/' + key).once('value').then(snapshot => {
            const t = snapshot.val();
            if (!t) return;
            document.getElementById('modalTeacherName').textContent = `${(t.fname || '')} ${(t.mname || '')} ${(t.lname || '')}`;
            let html = `
                <div><span class="modal-label">ID:</span> <span>${t.id || ''}</span></div>
                <div><span class="modal-label">First Name:</span> <span>${t.fname || ''}</span></div>
                <div><span class="modal-label">Middle Name:</span> <span>${t.mname || ''}</span></div>
                <div><span class="modal-label">Last Name:</span> <span>${t.lname || ''}</span></div>
                <div><span class="modal-label">Email:</span> <span>${t.email || ''}</span></div>
                <div><span class="modal-label">Grade Level:</span> <span>${t.grade || ''}</span></div>
                <div><span class="modal-label">Section:</span> <span>${t.section || ''}</span></div>
                <div><span class="modal-label">Address:</span> <span>${t.address || ''}</span></div>
                <div><span class="modal-label">Gender:</span> <span>${t.gender || ''}</span></div>
                <div><span class="modal-label">Age:</span> <span>${t.age || ''}</span></div>
                <div><span class="modal-label">School Year:</span> <span>${t.school_year || ''}</span></div>
                <div><span class="modal-label">Status:</span> <span>${t.approved ? '<span class="approved">Approved</span>' : '<span class="pending">Pending</span>'}</span></div>
                <div><span class="modal-label">Registered:</span> <span>${t.registeredAt ? new Date(t.registeredAt).toLocaleString() : '—'}</span></div>
                <div><span class="modal-label">Approved At:</span> <span>${t.approvedAt ? new Date(t.approvedAt).toLocaleString() : '—'}</span></div>
            `;
            document.getElementById('modalContent').innerHTML = html;
            document.getElementById('reviewModal').style.display = 'flex';
        });
    }
    function closeReviewModal() {
        document.getElementById('reviewModal').style.display = 'none';
    }

    // Success modal helpers
function openAdminCreatedModal(text){
  const m=document.getElementById('adminCreatedModal');
  document.getElementById('adminCreatedText').textContent = text || 'The admin account has been created successfully.';
  m.style.display='flex';
  m.setAttribute('aria-hidden','false');
}
function closeAdminCreatedModal(){
  const m=document.getElementById('adminCreatedModal');
  m.style.display='none';
  m.setAttribute('aria-hidden','true');
}
document.getElementById('adminCreatedOk')?.addEventListener('click', closeAdminCreatedModal);

    // Initial load
    loadTeachers();
    </script>
    </div>


    <!-- Insert Admin Registration form here (place just inside #mainContent, e.g. before the <h2>) -->
<section id="addAdminSection" style="display:none;max-width:920px;margin:18px auto;padding:0 18px;position:relative;">
  <style>
    /* Scoped styles for the inline admin form */
    #addAdminSection .reg-container {
      background: #fff;
      padding: 28px;
      border-radius: 14px;
      box-shadow: 0 6px 28px rgba(0,0,0,0.06);
      width: 420px;
      margin: 0 auto 22px auto;
      border: 2px solid #218838;
      box-sizing: border-box;
      max-height: calc(100vh - 140px);
      overflow: auto;
    }
    /* close button for inline form */
    #closeInlineAdminBtn {
      position: absolute;
      right: calc(50% - 210px); /* align near the form right edge */
      top: 8px;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 6px 10px;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      display: none; /* shown when section is visible */
    }
    #addAdminSection h2 { text-align:center; margin-bottom:18px; color:#218838; }
    #addAdminSection label { display:block; margin-bottom:8px; font-weight:600; color:#218838; }
    #addAdminSection .input-wrapper { position:relative; }
    #addAdminSection input[type="text"],
    #addAdminSection input[type="email"],
    #addAdminSection input[type="password"] {
      width:100%; padding:12px; margin-bottom:14px; border-radius:8px; border:2px solid #218838;
      background:#f6f7fb; box-sizing:border-box; font-size:15px;
    }
    #addAdminSection input:focus { outline:none; background:#e8f5e9; border-color:#17692c; }
    #addAdminSection .toggle-password { position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer; width:26px; height:26px; display:flex; align-items:center; justify-content:center; }
    #addAdminSection .field-error { color:#d32f2f; font-size:13px; margin-top:-10px; margin-bottom:8px; min-height:18px; }
    #addAdminSection button[type="submit"] { width:100%; padding:12px; border-radius:8px; border:none; background:#218838; color:#fff; font-weight:700; cursor:pointer; font-size:16px; }
    #addAdminSection .success { color:#2e7d32; text-align:center; margin-top:10px; }
    #addAdminSection .error { color:#c62828; text-align:center; margin-top:10px; }
  </style>

  <button id="closeInlineAdminBtn" aria-label="Close admin form">&times; Close</button>
   <div class="reg-container" role="region" aria-labelledby="adminFormTitle">
     <h2 id="adminFormTitle">Admin Registration</h2>

     <form id="inlineAdminRegForm" autocomplete="off" novalidate>
      <label for="firstName">First Name</label>
      <input type="text" id="firstName" name="firstName">
      <div id="errorFirstName" class="field-error"></div>

      <label for="middleName">Middle Name</label>
      <input type="text" id="middleName" name="middleName">
      <div id="errorMiddleName" class="field-error"></div>

      <label for="lastName">Last Name</label>
      <input type="text" id="lastName" name="lastName">
      <div id="errorLastName" class="field-error"></div>

      <label for="adminEmailInput">Email</label>
      <input type="email" id="adminEmailInput" name="adminEmail">
      <div id="errorAdminEmail" class="field-error"></div>

      <label for="adminPassword">Password</label>
      <div class="input-wrapper">
        <input type="password" id="adminPassword" name="adminPassword" style="padding-right:44px;">
        <span class="toggle-password" onclick="togglePassword('adminPassword', this)" aria-hidden="true">
          <svg class="eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="#ec407a" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke="#ec407a" stroke-width="2"/></svg>
          <svg class="eye-off hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path stroke="#ec407a" stroke-width="2" d="M3 3l18 18"/><path stroke="#ec407a" stroke-width="2" d="M10.73 10.73A3 3 0 0 0 12 15a3 3 0 0 0 2.27-4.27"/><path stroke="#ec407a" stroke-width="2" d="M1 12s4-7 11-7c2.54 0 4.68.7 6.41 1.7M21 12s-4 7-11 7c-2.54 0-4.68-.7-6.41-1.7"/></svg>
        </span>
      </div>
      <div id="errorAdminPassword" class="field-error"></div>

      <label for="confirmPassword">Confirm Password</label>
      <div class="input-wrapper">
        <input type="password" id="confirmPassword" name="confirmPassword" style="padding-right:44px;">
        <span class="toggle-password" onclick="togglePassword('confirmPassword', this)" aria-hidden="true">
          <svg class="eye" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="#ec407a" stroke-width="2"/><circle cx="12" cy="12" r="3" stroke="#ec407a" stroke-width="2"/></svg>
          <svg class="eye-off hidden" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24"><path stroke="#ec407a" stroke-width="2" d="M3 3l18 18"/><path stroke="#ec407a" stroke-width="2" d="M10.73 10.73A3 3 0 0 0 12 15a3 3 0 0 0 2.27-4.27"/><path stroke="#ec407a" stroke-width="2" d="M1 12s4-7 11-7c2.54 0 4.68.7 6.41 1.7M21 12s-4 7-11 7c-2.54 0-4.68-.7-6.41-1.7"/></svg>
        </span>
      </div>
      <div id="errorConfirmPassword" class="field-error"></div>

      <label style="font-weight:500;">
        <input type="checkbox" id="termsCheckbox" name="termsCheckbox" style="margin-right:8px;">
        I agree to the Terms and Conditions
      </label>
      <div id="errorTerms" class="field-error"></div>

      <button type="submit">Register</button>
      <div id="message" role="status" aria-live="polite"></div>
     </form>
   </div>
 </section>
<!-- end insert -->

<script>
// ...existing code...

// Show/hide inline admin form and wire the Add Admin button
(function () {
  const openBtn = document.getElementById('openAddAdminBtn');
  const addSection = document.getElementById('addAdminSection');
  const closeBtn = document.getElementById('closeInlineAdminBtn');

  if (!addSection) return;

  function showForm() {
    addSection.style.display = 'block';
    // show close button
    if (closeBtn) closeBtn.style.display = 'inline-block';
    // scroll into view centered
    addSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
  }
  function hideForm() {
    addSection.style.display = 'none';
    if (closeBtn) closeBtn.style.display = 'none';
  }

  if (openBtn) {
    openBtn.addEventListener('click', function (e) {
      e.stopPropagation();
      // close admin dropdown
      document.getElementById('adminDropdownContent')?.classList.remove('show');
      showForm();
    });
  }

  if (closeBtn) {
    closeBtn.addEventListener('click', hideForm);
  }

  // Clicking outside the form should not close the admin page; provide ESC to close
  document.addEventListener('keydown', function (ev) {
    if (ev.key === 'Escape' && addSection.style.display === 'block') hideForm();
  });

  // Ensure togglePassword is available globally (used by inline onclicks)
  if (typeof window.togglePassword !== 'function') {
    window.togglePassword = function(fieldId, iconEl){
      const input = document.getElementById(fieldId);
      if (!input) return;
      const eye = iconEl && iconEl.querySelector && iconEl.querySelector('.eye');
      const eyeOff = iconEl && iconEl.querySelector && iconEl.querySelector('.eye-off');
      if (input.type === 'password') {
        input.type = 'text';
        if (eye) eye.classList.add('hidden');
        if (eyeOff) eyeOff.classList.remove('hidden');
      } else {
        input.type = 'password';
        if (eye) eye.classList.remove('hidden');
        if (eyeOff) eyeOff.classList.add('hidden');
      }
    };
  }
})();

(() => {
  const form = document.getElementById('inlineAdminRegForm');
  if(!form) return;

  const f = id => document.getElementById(id);
  const msgEl = f('message');

  // Reuse config; create secondary app so we don't log out current admin
  let secondaryApp;
  function getSecondary(){
    if(!secondaryApp){
      secondaryApp = firebase.initializeApp(firebase.app().options, 'secondary');
    }
    return secondaryApp;
  }

  function setMsg(txt, ok){
    msgEl.textContent = txt;
    msgEl.className = ok ? 'success' : 'error';
  }

  form.addEventListener('submit', async e=>{
    e.preventDefault();
    // Clear errors
    ['FirstName','MiddleName','LastName','AdminEmail','AdminPassword','ConfirmPassword','Terms'].forEach(n=>{
      const el = document.getElementById('error'+n);
      if(el) el.textContent='';
    });
    setMsg('', true);

    const first = f('firstName').value.trim();
    const middle = f('middleName').value.trim();
    const last = f('lastName').value.trim();
    const email = f('adminEmailInput').value.trim();
    const pass = f('adminPassword').value;
    const pass2 = f('confirmPassword').value;
    const terms = f('termsCheckbox').checked;

    let invalid=false;
    if(!first){ f('errorFirstName').textContent='Required'; invalid=true; }
    if(!last){ f('errorLastName').textContent='Required'; invalid=true; }
    if(!email){ f('errorAdminEmail').textContent='Required'; invalid=true; }
    if(pass.length<6){ f('errorAdminPassword').textContent='Min 6 chars'; invalid=true; }
    if(pass!==pass2){ f('errorConfirmPassword').textContent='Passwords differ'; invalid=true; }
    if(!terms){ f('errorTerms').textContent='Accept terms'; invalid=true; }
    if(invalid) return;

    setMsg('Creating admin account...', true);
    form.querySelector('button[type=submit]').disabled=true;

    try{
      const sec = getSecondary();
      const cred = await sec.auth().createUserWithEmailAndPassword(email, pass);
      const uid = cred.user.uid;
      const adminData = {
        uid,
        email,
        fname:first,
        mname:middle,
        lname:last,
        role:'admin',
        createdAt: Date.now()
      };
      await firebase.database().ref('admins/'+uid).set(adminData);
      setMsg('Admin created.', true);
      openAdminCreatedModal('Admin '+(adminData.fname||'')+' '+(adminData.lname||'')+' has been created.');

      // Clean up & keep current admin session
      await sec.auth().signOut();
      form.reset();
    }catch(err){
      console.error(err);
      setMsg(err.message || 'Error creating admin', false);
    }finally{
      form.querySelector('button[type=submit]').disabled=false;
    }
  });
})();
</script>
</body>
</html>