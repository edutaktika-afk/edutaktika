<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Login & Register</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="../CSS/fonts.css">
<!-- ...inside <head> -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
   <style>
    :root {
        --primary: #2e8b57;
        --secondary: #ffd700;
        --accent: #ff69b4;
        --mint: #eafff3;
        --peach: #f5bda8;
        --input-bg: #fff;
        --input-shadow: 2px 2px 0 #baffd9, 0 2px 8px #0001;
    }
    html, body {
        height: 100%;
        margin: 0;
        padding: 0;
        background: #f7f9fb;
        font-family: 'Baloo 2', 'Comic Sans MS', cursive, sans-serif;
        box-sizing: border-box;
    }
    /* Global font consistency (student) */
    body, button, input, select, textarea, label, p, h1, h2, h3, h4, h5, h6, .tab-btn, .action-btn, .container, .auth-hero-content {
        font-family: 'Baloo 2', 'Comic Sans MS', cursive, sans-serif;
    }
    /* Preserve FontAwesome */
    .fa, .fas, .far, .fal, .fab { font-family: 'Font Awesome 6 Free'; }
    .fas, .fa-solid { font-weight: 900; }
    .fa::before, .fas::before, .far::before, .fal::before, .fab::before { font-family: 'Font Awesome 6 Free'; font-weight: 900; }
    body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .auth-main-container {
        display: flex;
        width: 100%;
        min-height: 100vh;
        box-sizing: border-box;
        background: white;
        border-radius: 16px;
        overflow: hidden;
        padding: 32px 0;
    }
    .auth-left {
        flex: 1.1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: flex-start;
        padding: 0 0 0 5vw;
        min-width: 340px;
        margin-left: 100px;
    }
    .auth-hero-content {
        max-width: 480px;
        text-align: left;
    }
    .auth-hero-content h1 {
        font-size: 3rem;
        font-weight: 800;
        color: #111;
        margin-bottom: 18px;
        line-height: 1.1;
    }
    .auth-hero-content p {
        color: #444;
        font-size: 1.1rem;
        margin-bottom: 32px;
        max-width: 420px;
        letter-spacing: 0.02em;
    }
    .auth-hero-img {
        width: 340px;
        max-width: 90vw;
        height: auto;
        display: block;
        margin-top: 24px;
        animation: swing 3s ease-in-out infinite;
        transform-origin: 50% 0%;
    }
    @keyframes swing {
        0%   { transform: rotate(0deg);}
        20%  { transform: rotate(8deg);}
        50%  { transform: rotate(-8deg);}
        80%  { transform: rotate(8deg);}
        100% { transform: rotate(0deg);}
    }
    .auth-right {
        flex: 1;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        padding: 0 5vw 0 0;
        min-width: 340px;
        margin-right: 100px;
    }
    .container {
        background: rgba(255,255,255,0.98);
        border-radius: 18px;
        box-shadow: 0 8px 32px #2e8b5733, 0 2px 8px #ffd70055;
        padding: 32px 24px 24px 24px;
        width: 100%;
        max-width: 650px;
        min-width: 460px;
        position: relative;
        box-sizing: border-box;
        z-index: 2;
        border: 2px solid var(--primary);
        animation: popIn 0.7s;
        min-height: 200px;
        max-height: 90vh;
        overflow-y  : auto;
    }
    @keyframes popIn {
        0% { transform: scale(0.95) translateY(30px); opacity: 0;}
        100% { transform: scale(1) translateY(0); opacity: 1;}
    }
    .tabs {
        display: flex;
        margin-bottom: 14px;
        background: #eaf4ff;
        border-radius: 12px 12px 0 0;
        overflow: hidden;
        box-shadow: 0 2px 8px #ffd70033;
    }
    .tab-btn {
        flex: 1;
        padding: 8px 0;
        background: transparent;
        border: none;
        font-weight: bold;
        color: #3f4d34;
        cursor: pointer;
        transition: background 0.2s, color 0.2s;
        font-size: 1rem;
        letter-spacing: 1px;
    }
    .tab-btn.active {
        background: #2e8b57;
        color: #fff;
        box-shadow: 0 2px 8px #ffd70033;
    }
input[type="text"], input[type="password"], input[type="number"], input[type="email"], input[type="date"], select {
        width: 100%;
        padding: 9px 8px 9px 30px;
        border: 1.5px solid var(--peach);
        border-radius: 6px;
        font-size: 0.97rem;
        background: #eaf4ff;
        margin-bottom: 12px;
        box-sizing: border-box;
        transition: border 0.2s, box-shadow 0.2s;
        outline: none;
        color: #3f4d34;
        font-family: inherit;
    }
    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus, input[type="email"]:focus, input[type="date"]:focus {
        border: 2px solid var(--secondary);
        background: #f8fafc;
        box-shadow: 0 2px 8px #6a82fb22;
    }
    select {
        width: 100%;
        padding: 8px 10px 8px 32px;
        border: 1.5px solid #b5d8ff;
        border-radius: 6px;
        font-size: 0.97rem;
        background: #eaf4ff;
        box-sizing: border-box;
        transition: border 0.2s, box-shadow 0.2s;
        outline: none;
        color: #232946;
        font-family: inherit;
    }
    select:focus {
        border: 2px solid #6a82fb;
        background: #f8fafc;
        box-shadow: 0 2px 8px #6a82fb22;
    }
label {
    font-weight: 600;
    color: #3f4d34;
    margin-bottom: 4px;
    display: block;
    font-size: 1rem;
}
.form-group {
    margin-bottom: 8px;
    position: relative;
}
.input-icon {
    position: absolute;
    left: 10px;
    top: 38px;
    color: var(--primary);
    font-size: 1.1em;
    pointer-events: none;
}
.toggle-password {
    color: var(--accent);
    font-size: 1.1em;
}
.action-btn, button[type="submit"] {
    width: 100%;
    padding: 14px 0;
    background:  var(--primary);
    color: white;
    font-weight: 800;
    font-size: 1.2rem;
    border: none;
    border-radius: 10px;
    margin-top: 10px;
    margin-bottom: 10px;
    box-shadow: 2px 2px 0 #baffd9, 0 2px 8px #0001;
    cursor: pointer;
    transition: background 0.18s, color 0.18s, box-shadow 0.18s;
}
.action-btn:hover, button[type="submit"]:hover {
    background: var(--secondary);
    color: #3f4d34;
    box-shadow: 2px 2px 0 var(--primary), 0 4px 16px #0002;
}
.error {
    background: #ffeaea;
    color: #c0392b;
    border: 1px solid #ffb6b9;
    border-radius: 8px;
    padding: 10px 14px;
    margin-bottom: 12px;
    font-size: 1rem;
}
/* Live validation styles */
.input-error {
    border: 2px solid #e74c3c !important;
    background: #fdf2f2 !important;
    box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
}
.input-success {
    border: 2px solid #27ae60 !important;
    background: #f8fff8 !important;
    box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1) !important;
}
.field-warning {
    color: #e74c3c;
    font-size: 0.85rem;
    margin-top: 2px;
    display: block;
}
.field-success {
    color: #27ae60;
    font-size: 0.85rem;
    margin-top: 2px;
    display: block;
}
@media (max-width: 1100px) {
    .auth-main-container {
        flex-direction: column;
        align-items: center;
        padding: 0;
    }
    .auth-left, .auth-right {
        align-items: center;
        justify-content: center;
        padding: 0;
    }
    .auth-hero-content {
        text-align: center;
    }
}
@media (max-width: 700px) {
    .auth-main-container {
        align-items: stretch !important;
        min-height: 100vh !important;
        height: auto !important;
    }
    body {
        align-items: flex-start !important;
        justify-content: flex-start !important;
    }
    .auth-left, .auth-right {
        width: 100%;
        min-width: 0;
        margin: 0;
        padding: 0 0 0 0;
        align-items: center;
        justify-content: center;
    }
    .auth-hero-content {
        text-align: center;
        padding: 0 2vw;
    }
    .auth-hero-content h1 {
        font-size: 1.5rem;
        margin-bottom: 10px;
    }
    .auth-hero-content p {
        font-size: 1rem;
        margin-bottom: 18px;
        max-width: 95vw;
    }
    .auth-hero-img {
        display: block;
        margin: 14px auto 0 auto; /* <-- center image */
        width: 220px;
    }
    .container {
        background: rgba(255,255,255,0.98);
        border-radius: 18px;
        box-shadow: 0 8px 32px #2e8b5733, 0 2px 8px #ffd70055;
        padding: 32px 24px 24px 24px;
        width: 100%;
        max-height: none !important;
        min-width: 0;           /* <-- allow shrinking on mobile */
        position: relative;
        box-sizing: border-box;
        z-index: 2;
        border: 2px solid var(--primary);
        animation: popIn 0.7s;
        min-height: 0 !important;
        height: auto !important;
        box-sizing: border-box;
        max-height: 90vh;
        overflow-y: visible !important;
    }
    .form-row {
        
        gap: 0;
    }
    .form-row.name-row {
        flex-direction: column;
        gap: 0;
    }
    #reg_mname {
        width: 100% !important;
    }
    #reg_lname, #reg_fname {
        width: 100% !important;
    }
    .form-row.name-row .form-group {
        margin-left: 0 !important;
        margin-right: 0 !important;
    }
    .form-group {
        margin-bottom: 5px;
        min-width: 0;
    }
    input, select {
        font-size: 1rem;
        min-width: 0;
    }
    .action-btn, button[type="submit"] {
        font-size: 1rem;
        padding: 12px 0;
    }
    .tabs {
        flex-direction: row;
        font-size: 1rem;
    }
    .tab-btn {
        font-size: 1rem;
        padding: 8px 0;
    }
    .form-group {
        margin-bottom: 10px;
    }
    .tabs {
        flex-direction: row;
        font-size: 0.98rem;
    }
    .tab-btn {
        font-size: 0.98rem;
        padding: 8px 0;
    }
    .action-btn, button[type="submit"] {
        font-size: 1rem;
        padding: 12px 0;
    }
    label {
        font-size: 0.98rem;
    }
    input, select {
        font-size: 0.97rem;
    }
    .btnBack button {
        padding: 7px 10px;
        font-size: 0.95rem;
        border-radius: 6px;
        box-shadow: 1px 1px 0 #baffd9;
    }
    .btnBack {
        top: 10px !important;
        right: 10px !important;
    }
}

/* Hide scrollbars on mobile for a cleaner look */
@media (max-width: 700px) {
    html, body {
        scrollbar-width: none;         /* Firefox */
        -ms-overflow-style: none;      /* IE and Edge */
    }
    html::-webkit-scrollbar, body::-webkit-scrollbar {
        display: none;                 /* Chrome, Safari, Opera */
    }
}
.form-row {
    display: flex;
    gap: 16px;
}
.form-row .form-group {
    flex: 1;
}


    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
</head>
<body>
    <a href="../Student/logreg.html" style="position:fixed;top:24px;right:24px;z-index:1000;text-decoration:none;">
        <button style="background:#2e8b57;color:#fff;border:none;padding:10px 15px;border-radius:8px;font-size:1rem;cursor:pointer;box-shadow:2px 2px 0 #baffd9;">
            ← Student
        </button>
    </a>
    <div class="auth-main-container">
        <div class="auth-left">
            <div class="auth-hero-content">
                <h1>Kids Learn<br>Faster Visually</h1>
                <p>
                    Did you know that kids learn a significant amount more than kids who learn the traditional way?
                </p>
                <img src="../images/edutaktika.png" alt="Visual Learning" class="auth-hero-img" />
            </div>
        </div>
        <div class="auth-right">
            <div class="container">
                <h2 style="text-align:center; color:#2e8b57; margin-top:0;">Teacher</h2>
                <div class="tabs">
                    <button class="tab-btn active" id="loginTab" onclick="showTab('login')">Login</button>
                    <button class="tab-btn" id="registerTab" onclick="showTab('register')">Register</button>
                </div>
                <!-- Login Form -->
                <div class="form-section" id="loginSection" style="display:block;">
                    <!-- <div class="error">Invalid email or password.</div> -->
                    <form id="loginForm" autocomplete="off">
                        <div class="form-group">
                            <span class="input-icon"><i class="fas fa-envelope"></i></span>
                            <label for="login_email">Email</label>
                            <input type="email" name="login_email" id="login_email" required>
                        </div>
                        <div class="form-group" style="position:relative;">
                            <span class="input-icon"><i class="fas fa-lock"></i></span>
                            <label for="login_password">Password</label>
                            <input type="password" name="login_password" id="login_password" required>
                            <span class="toggle-password" onclick="togglePassword('login_password', this)" style="position:absolute;right:12px;top:38px;cursor:pointer;">
                                <i class="fas fa-eye"></i>
                            </span>
                        </div>
                        <button type="submit" class="action-btn">Login</button>
                    </form>
                </div>
                <!-- Register Form -->
                <div class="form-section" id="registerSection">
                    <!-- <div class="error">All fields except Middle Name are required.</div> -->
                    <form id="registerForm" autocomplete="off">
                        <div class="form-inner">
                            <div class="form-group">
                                <span class="input-icon"><i class="fas fa-id-card"></i></span>
                                <label for="reg_id">ID Number</label>
                                <input type="text" name="reg_id" id="reg_id" required pattern="\d{6}" inputmode="numeric" maxlength="6" minlength="6" oninput="this.value=this.value.replace(/[^0-9]/g,'');">
                                <div id="lrn-message" style="font-size:0.95em;color:#c0392b;margin-top:2px;"></div>
                                <span id="lrn-warning" class="field-warning" style="display:none;">ID is required</span>
                            </div>
                            <div class="form-row name-row" >
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-user"></i></span>
                                    <label for="reg_fname">First Name</label>
                                    <input type="text" pattern="[A-Za-z]+" name="reg_fname" id="reg_fname" required>
                                    <span id="fname-warning" class="field-warning" style="display:none;">First name is required</span>
                                </div>
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-user"></i></span>
                                    <label for="reg_mname">M.I</label>
                                    <input type="text" pattern="[A-Za-z]+" name="reg_mname" id="reg_mname">
                                </div>
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-user"></i></span>
                                    <label for="reg_lname">Last Name</label>
                                    <input type="text" name="reg_lname" id="reg_lname" required>
                                    <span id="lname-warning" class="field-warning" style="display:none;">Last name is required</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <span class="input-icon"><i class="fas fa-envelope"></i></span>
                                <label for="reg_email">Email</label>
                                <input type="email" name="reg_email" id="reg_email" required>
                                <span id="email-warning" class="field-warning" style="display:none;">Email is required</span>
                            </div>
                            <!-- Province (fixed) + ZIP / Region pair below -->
                            <div class="form-group">
                                <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                                <label for="reg_address_province">Province</label>
                                <input type="text" name="reg_address_province" id="reg_address_province" value="Pampanga" readonly style="background:#eee;cursor:not-allowed;">
                            </div>
                            <!-- Municipality and Barangay -->
                            <div class="form-row pair">
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                                    <label for="reg_address_city">Municipality/City</label>
                                    <!-- FIXED municipality to Apalit (readonly) -->
                                    <input type="text" name="reg_address_city" id="reg_address_city" value="Apalit" readonly style="background:#eee;cursor:not-allowed;">
                                </div>
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                                    <label for="reg_address_barangay">Barangay</label>
                                    <select name="reg_address_barangay" id="reg_address_barangay" required>
                                        <option value="">Select Barangay</option>
                                        <option value="Balucuc">Balucuc</option>
                                        <option value="Calantipe">Calantipe</option>
                                        <option value="Cansinala">Cansinala</option>
                                        <option value="Colgante">Colgante</option>
                                        <option value="Sampaloc">Sampaloc</option>
                                        <option value="Sucad">Sucad</option>
                                    </select>
                                    <span id="barangay-warning" class="field-warning" style="display:none;">Please select a barangay</span>
                                </div>
                            </div>
                            <div class="form-group">
                                <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                                <label for="reg_address_street">House/Building No. & Street</label>
                                <input type="text" name="reg_address_street" id="reg_address_street" placeholder="" required>
                                <span id="street-warning" class="field-warning" style="display:none;">Street address is required</span>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                                    <label for="reg_address_zip">ZIP Code</label>
                                    <!-- FIXED ZIP to 2016 for Apalit area (readonly) -->
                                    <input type="text" name="reg_address_zip" id="reg_address_zip" value="2016" readonly style="background:#eee;cursor:not-allowed;">
                                </div>
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                                    <label for="reg_address_region">Region <span style="font-weight:400;color:#888;">(optional)</span></label>
                                    <input type="text" name="reg_address_region" id="reg_address_region" placeholder="">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-graduation-cap"></i></span>
                                    <label for="reg_grade">Grade Level</label>
                                    <select name="reg_grade" id="reg_grade" required>
                                        <option value="">Select Grade</option>
                                        <option value="5">Grade 5</option>
                                        <option value="6">Grade 6</option>
                                    </select>
                                </div>
                               
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-users"></i></span>
                                    <label for="reg_section">Section</label>
                                    <select name="reg_section" id="reg_section" required>
                                        <option value="">Select Section</option>
                                        <option value="Apple">Apple</option>
                                        <option value="Banana">Banana</option>
                                        <option value="Cherry">Cherry</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-hourglass-half"></i></span>
                                    <label for="reg_age">Age</label>
                                    <!-- Added inputmode numeric; JS will sanitize to 1-99 only -->
                                    <input type="number" name="reg_age" id="reg_age" min="1" max="99" required inputmode="numeric" aria-describedby="age-note age-status">
                                    <div id="age-note" style="font-size:0.8rem;color:#555;margin-top:2px;">Allowed: 1 - 99</div>
                                    <div id="age-status" style="font-size:0.8rem;margin-top:2px;min-height:16px;"></div>
                                </div>
                                 <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-venus-mars"></i></span>
                                    <label for="reg_gender">Gender</label>
                                    <!-- CHANGED: added placeholder option so required works -->
                                    <select name="reg_gender" id="reg_gender" required style="padding-left:38px;">
                                        <option value="" disabled selected>Select</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <span class="input-icon"><i class="fas fa-calendar"></i></span>
                                    <label for="reg_school_year">School Year</label>
                                    <select name="reg_school_year" id="reg_school_year" required>
                                        <option value="">School Year</option>
                                        <option value="2024-2025">2024-2025</option>
                                        <option value="2025-2026">2025-2026</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group" style="position:relative;">
                                <span class="input-icon"><i class="fas fa-lock"></i></span>
                                <label for="reg_password">Password</label>
                                <input type="password" name="reg_password" id="reg_password" required>
                                <span class="toggle-password" onclick="togglePassword('reg_password', this)" style="position:absolute;right:12px;top:38px;cursor:pointer;">
                                    <i class="fas fa-eye"></i>
                                </span>
                                <div id="password-strength-message" style="margin-top:6px;font-size:0.95em;"></div>
                            </div>
                            <div class="form-group" style="position:relative;">
                                <span class="input-icon"><i class="fas fa-lock"></i></span>
                                <label for="reg_confirm_password">Confirm Password</label>
                                <input type="password" name="reg_confirm_password" id="reg_confirm_password" required>
                                <span class="toggle-password" onclick="togglePassword('reg_confirm_password', this)" style="position:absolute;right:12px;top:38px;cursor:pointer;">
                                    <i class="fas fa-eye"></i>
                                </span>
                                <div id="password-match-message" style="margin-top:6px;font-size:0.95em;"></div>
                            </div>
                            <button type="submit" class="action-btn">Register</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="registerSuccessModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:99999;align-items:center;justify-content:center;">
  <div style="background:#fff;padding:32px 28px;border-radius:14px;max-width:350px;width:90%;box-shadow:0 4px 24px #0002;text-align:center;position:relative;">
    <h3 style="margin-top:0;">Registration Successful!</h3>
    <p style="margin-bottom:24px;">Please check your email to verify your account before logging in.<br>(Check your spam/junk folder too.)</p>
    <button onclick="closeRegisterSuccessModal()" style="background:#2e8b57;color:#fff;border:none;padding:10px 24px;border-radius:8px;font-size:1rem;cursor:pointer;">OK</button>
  </div>
</div>

        <!-- Reusable custom alert modal (static markup to avoid script text leaking) -->
        <div id="customAlertModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:99999;align-items:center;justify-content:center;">
            <div style="background:#fff;padding:32px 28px;border-radius:14px;max-width:350px;width:90%;box-shadow:0 4px 24px #0002;text-align:center;position:relative;">
                <p id="customAlertMessage" style="margin-bottom:24px;"></p>
                <button id="customAlertOkBtn" style="background:#2e8b57;color:#fff;border:none;padding:10px 24px;border-radius:8px;font-size:1rem;cursor:pointer;">OK</button>
            </div>
        </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>

   
<script>
  
const passwordInput = document.getElementById('reg_password');
const confirmInput = document.getElementById('reg_confirm_password');
const strengthMsg = document.getElementById('password-strength-message');
const matchMsg = document.getElementById('password-match-message');

// Password strength live feedback
passwordInput.addEventListener('input', function() {
    const val = passwordInput.value;
    // Strong password: 8+ chars, uppercase, lowercase, number, special char
    const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;
    if (val.length === 0) {
        strengthMsg.textContent = '';
    } else if (strongPasswordRegex.test(val)) {
        strengthMsg.textContent = 'Strong password ✔️';
        strengthMsg.style.color = 'green';
    } else {
        strengthMsg.textContent = 'Password must be at least 8 characters and include uppercase, lowercase, number, and special character.';
        strengthMsg.style.color = 'red';
    }
    checkPasswordMatch();
});

confirmInput.addEventListener('input', checkPasswordMatch);
passwordInput.addEventListener('input', checkPasswordMatch);

function checkPasswordMatch() {
    if (confirmInput.value.length === 0) {
        matchMsg.textContent = '';
        return;
    }
    if (passwordInput.value === confirmInput.value) {
        matchMsg.textContent = 'Passwords match ✔️';
        matchMsg.style.color = 'green';
    } else {
        matchMsg.textContent = 'Passwords do not match!';
        matchMsg.style.color = 'red';
    }
}

// Firebase config (already in your code)
const firebaseConfig = {
    apiKey: "AIzaSyB5BbeLLvPX8l1c4Lq0f-CmIUml4hQOQlE",
    authDomain: "edutaktika.firebaseapp.com",
    databaseURL: "https://edutaktika-default-rtdb.firebaseio.com",
    projectId: "edutaktika",
    storageBucket: "edutaktika.appspot.com",
    messagingSenderId: "676848575316",
    appId: "1:676848575316:web:f78f8c0f83bf3d9dfb5ec1",
    measurementId: "G-X3GT5TNN87"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const auth = firebase.auth();

// Age live validation - ZIP is now fixed to 2016
const ageInput = document.getElementById('reg_age');

function validateAge() {
    if (ageInput.value === '') { ageInput.setCustomValidity(''); return false; }
    const val = parseInt(ageInput.value,10);
    if (isNaN(val)) { ageInput.setCustomValidity('Age must be a number.'); return false; }
    if (val > 99) { ageInput.setCustomValidity('Age must not exceed 99.'); return false; }
    if (val < 1) { ageInput.setCustomValidity('Age must be at least 1.'); return false; }
    ageInput.setCustomValidity('');
    return true;
}

const ageStatus = document.getElementById('age-status');
function setAgeStatus(text, color) { ageStatus.textContent = text; ageStatus.style.color = color; }

// Debounce utility
function debounce(fn, delay=120) { let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), delay); }; }

// Sanitize & clamp input: remove non-digits, clamp to [1,110]
ageInput.addEventListener('input', debounce(function() {
    let raw = ageInput.value.replace(/[^0-9]/g, '');
    if (raw === '') { ageInput.value=''; ageInput.setCustomValidity(''); setAgeStatus('', ''); return; }
    let num = parseInt(raw,10);
    if (isNaN(num)) { ageInput.value=''; setAgeStatus('Age must be numeric.', '#c0392b'); return; }
    if (num > 99) { num = 99; setAgeStatus('Clamped to 99 (max).', '#c0392b'); }
    else if (num < 1) { ageInput.value=''; ageInput.setCustomValidity('Age must be at least 1.'); setAgeStatus('Age must be at least 1.', '#c0392b'); return; }
    ageInput.value = num.toString();
    if (validateAge()) setAgeStatus('✔️ Age OK', 'green');
}, 90));

// Registration handler
document.getElementById('registerForm').onsubmit = async function(e) {
    e.preventDefault();
    const email = document.getElementById('reg_email').value;
    if (!validateAge()) { return; }
    const password = document.getElementById('reg_password').value;
    const confirm = document.getElementById('reg_confirm_password').value;
    const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;

    if (!strongPasswordRegex.test(password)) {
        // Optionally show a message in the UI instead of alert
        return;
    }
    if (password !== confirm) {
        // Optionally show a message in the UI instead of alert
        return;
    }
    const lrn = document.getElementById('reg_id').value;
    if (!/^\d{6}$/.test(lrn)) {
        showCustomModal('ID number must be exactly 6 digits.');
        return;
    }
    // Collect other fields
    const userData = {
        id: lrn,
        fname: document.getElementById('reg_fname').value,
        mname: document.getElementById('reg_mname').value,
        lname: document.getElementById('reg_lname').value,
        address: {
            street: document.getElementById('reg_address_street').value,
            barangay: document.getElementById('reg_address_barangay').value,
            city: document.getElementById('reg_address_city').value,
            province: document.getElementById('reg_address_province').value,
            zip: document.getElementById('reg_address_zip').value,
            region: document.getElementById('reg_address_region').value,
        },
        gender: document.getElementById('reg_gender').value,
        age: document.getElementById('reg_age').value,
        email: email,
        
        grade: document.getElementById('reg_grade').value,     // (optional, for clarity)
        section: document.getElementById('reg_section').value, // (optional, for clarity)
        school_year: document.getElementById('reg_school_year').value, // (optional)
        role: "teacher",
        approved: false,
        registeredAt: new Date().toISOString()
    };
    try {
        // Create user in Firebase Auth
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const uid = user.uid;
        // Save user data in Realtime Database under "teachers"
        await db.ref('teachers/' + uid).set(userData);

        // Copy all global lessons to this new teacher
        async function copyGlobalLessonsToTeacher(teacherUID, section) {
            const subjects = ['subject_math', 'subject_science', 'subject_english'];
            for (const subject of subjects) {
                for (let q = 1; q <= 4; q++) {
                    const snap = await db.ref('presentations/' + subject + '/quarter-' + q).once('value');
                    if (snap.exists()) {
                        snap.forEach(child => {
                            const lessonData = child.val();
                            const title = lessonData.title || child.key;
                            db.ref('teachers/' + teacherUID + '/sections/' + section + '/lessons/' + subject + '/quarter-' + q + '/' + title).set(lessonData);
                        });
                    }
                }
            }
        }
        await copyGlobalLessonsToTeacher(uid, userData.section);
        // Send verification email
        try {
            await user.sendEmailVerification();
        } catch (err) {
            // Do not show alert, just log error
            console.log("Failed to send verification email: " + err.message);
        }
        // Show only the modal, no alert
        showRegisterSuccessModal();
        await auth.signOut();
        document.getElementById('registerForm').reset();
    } catch (error) {
        // Optionally show a message in the UI instead of alert
        console.log(error);
    }
};

// Login handler

document.getElementById('loginForm').onsubmit = async function(e) {
    e.preventDefault();
    const email = document.getElementById('login_email').value;
    const password = document.getElementById('login_password').value;

    // Check for admin credentials
    if (email === "edutaktika@gmail.com" && password === "Adminedutaktika0!") {
        try {
            const userCredential = await auth.signInWithEmailAndPassword(email, password);
            const user = userCredential.user;
            if (!user.emailVerified) {
                showCustomModal('Please verify your email before logging in.');
                await auth.signOut();
                return;
            }
            window.location.href = "admin.html";
            return;
        } catch (error) {
            showCustomModal('Invalid admin email or password.');
            return;
        }
    }

    // Teacher login logic with approval check
    try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const uid = user.uid;
        const snapshot = await db.ref('teachers/' + uid).once('value');
        const teacher = snapshot.val();

        if (!user.emailVerified) {
            showCustomModal('Please verify your email before logging in.');
            await auth.signOut();
            return;
        }
        if (!teacher || teacher.approved !== true) {
            showCustomModal('Your account is pending approval by the admin.');
            await auth.signOut();
            return;
        }
        // Both verified and approved
        window.location.href = "homepage.html";
    } catch (error) {
        showCustomModal('Invalid email or password.');
    }
};

function showRegisterSuccessModal() {
    document.getElementById('registerSuccessModal').style.display = 'flex';
}
function closeRegisterSuccessModal() {
    document.getElementById('registerSuccessModal').style.display = 'none';
    showTab('login');
}

document.addEventListener("DOMContentLoaded", function() {
    function checkAuthReady(cb) {
        if (window.firebase && firebase.auth) cb();
        else setTimeout(() => checkAuthReady(cb), 100);
    }
    checkAuthReady(function() {
        firebase.auth().onAuthStateChanged(async function(user) {
            if (user) {
                const uid = user.uid;
                const snapshot = await db.ref('teachers/' + uid).once('value');
                const teacher = snapshot.val();
                if (teacher && user.emailVerified && teacher.approved === true) {
                    window.location.href = "homepage.html";
                } else if (teacher && !user.emailVerified) {
                    if (document.getElementById('loginSection').style.display !== "none") {
                        alert('Please verify your email before logging in.');
                    }
                    await firebase.auth().signOut();
                } else if (teacher && teacher.approved !== true) {
                    showCustomModal('Your account is pending approval by the admin.');
                    await firebase.auth().signOut();
                } else {
                    await firebase.auth().signOut();
                    window.location.href = "../index.html";
                }
            }
            // If not logged in, stay on login page
        });
    });
}); 

function showCustomModal(message) {
  const modal = document.getElementById('customAlertModal');
  document.getElementById('customAlertMessage').textContent = message;
  modal.style.display = 'flex';
  document.getElementById('customAlertOkBtn').onclick = () => { modal.style.display = 'none'; };
}

const lrnInput = document.getElementById('reg_id');
const lrnMsg = document.getElementById('lrn-message');

lrnInput.addEventListener('input', function() {
    if (lrnInput.value.length === 0) {
        lrnMsg.textContent = '';
    } else if (lrnInput.value.length < 6) {
        lrnMsg.textContent = 'ID number must be exactly 6 digits.';
        lrnMsg.style.color = '#c0392b';
    } else if (lrnInput.value.length > 6) {
        lrnMsg.textContent = 'ID number must be exactly 6 digits.';
        lrnMsg.style.color = '#c0392b';
    } else {
        lrnMsg.textContent = '✔️ ID number is valid.';
        lrnMsg.style.color = 'green';
    }
});
</script>

 <script src="../assets/js/Teacher Side/logreg.js"></script>
<script>
// Password visibility toggle helper (added)
function togglePassword(id, trigger){
    const input = document.getElementById(id);
    if(!input) return;
    const icon = trigger.querySelector('i');
    const showing = input.type === 'text';
    input.type = showing ? 'password' : 'text';
    if(icon){
        icon.classList.toggle('fa-eye', showing);
        icon.classList.toggle('fa-eye-slash', !showing);
    }
}
</script>

<script>
/* === Municipality is now fixed to Apalit, barangays are hardcoded in HTML === */

// Live validation for required fields
function validateField(field, warningId, customMessage = null) {
    const warning = document.getElementById(warningId);
    const isValid = field.value.trim() !== '';
    
    if (isValid) {
        field.classList.remove('input-error');
        field.classList.add('input-success');
        warning.style.display = 'none';
    } else {
        field.classList.remove('input-success');
        field.classList.add('input-error');
        warning.style.display = 'block';
        if (customMessage) {
            warning.textContent = customMessage;
        }
    }
    
    return isValid;
}

// Add live validation to required fields
document.addEventListener('DOMContentLoaded', function() {
    // ID field
    const idField = document.getElementById('reg_id');
    idField.addEventListener('blur', () => validateField(idField, 'lrn-warning'));
    idField.addEventListener('input', () => {
        if (idField.value.trim() !== '') {
            idField.classList.remove('input-error');
            idField.classList.add('input-success');
            document.getElementById('lrn-warning').style.display = 'none';
        }
    });
    
    // First Name field
    const fnameField = document.getElementById('reg_fname');
    fnameField.addEventListener('blur', () => validateField(fnameField, 'fname-warning'));
    fnameField.addEventListener('input', () => {
        if (fnameField.value.trim() !== '') {
            fnameField.classList.remove('input-error');
            fnameField.classList.add('input-success');
            document.getElementById('fname-warning').style.display = 'none';
        }
    });
    
    // Last Name field
    const lnameField = document.getElementById('reg_lname');
    lnameField.addEventListener('blur', () => validateField(lnameField, 'lname-warning'));
    lnameField.addEventListener('input', () => {
        if (lnameField.value.trim() !== '') {
            lnameField.classList.remove('input-error');
            lnameField.classList.add('input-success');
            document.getElementById('lname-warning').style.display = 'none';
        }
    });
    
    // Email field
    const emailField = document.getElementById('reg_email');
    emailField.addEventListener('blur', () => {
        const isValid = emailField.value.trim() !== '' && emailField.checkValidity();
        validateField(emailField, 'email-warning');
    });
    emailField.addEventListener('input', () => {
        if (emailField.value.trim() !== '') {
            emailField.classList.remove('input-error');
            if (emailField.checkValidity()) {
                emailField.classList.add('input-success');
            }
            document.getElementById('email-warning').style.display = 'none';
        }
    });
    
    // Barangay field
    const barangayField = document.getElementById('reg_address_barangay');
    barangayField.addEventListener('change', () => validateField(barangayField, 'barangay-warning'));
    
    // Street field
    const streetField = document.getElementById('reg_address_street');
    streetField.addEventListener('blur', () => validateField(streetField, 'street-warning'));
    streetField.addEventListener('input', () => {
        if (streetField.value.trim() !== '') {
            streetField.classList.remove('input-error');
            streetField.classList.add('input-success');
            document.getElementById('street-warning').style.display = 'none';
        }
    });
    
    // Grade field
    const gradeField = document.getElementById('reg_grade');
    gradeField.addEventListener('change', () => {
        const warning = document.getElementById('grade-warning') || (() => {
            const span = document.createElement('span');
            span.id = 'grade-warning';
            span.className = 'field-warning';
            span.style.display = 'none';
            span.textContent = 'Please select a grade level';
            gradeField.parentNode.appendChild(span);
            return span;
        })();
        validateField(gradeField, 'grade-warning');
    });
    
    // Section field
    const sectionField = document.getElementById('reg_section');
    sectionField.addEventListener('change', () => {
        const warning = document.getElementById('section-warning') || (() => {
            const span = document.createElement('span');
            span.id = 'section-warning';
            span.className = 'field-warning';
            span.style.display = 'none';
            span.textContent = 'Please select a section';
            sectionField.parentNode.appendChild(span);
            return span;
        })();
        validateField(sectionField, 'section-warning');
    });
    
    // Gender field
    const genderField = document.getElementById('reg_gender');
    genderField.addEventListener('change', () => {
        const warning = document.getElementById('gender-warning') || (() => {
            const span = document.createElement('span');
            span.id = 'gender-warning';
            span.className = 'field-warning';
            span.style.display = 'none';
            span.textContent = 'Please select a gender';
            genderField.parentNode.appendChild(span);
            return span;
        })();
        validateField(genderField, 'gender-warning');
    });
    
    // School Year field
    const schoolYearField = document.getElementById('reg_school_year');
    schoolYearField.addEventListener('change', () => {
        const warning = document.getElementById('schoolyear-warning') || (() => {
            const span = document.createElement('span');
            span.id = 'schoolyear-warning';
            span.className = 'field-warning';
            span.style.display = 'none';
            span.textContent = 'Please select a school year';
            schoolYearField.parentNode.appendChild(span);
            return span;
        })();
        validateField(schoolYearField, 'schoolyear-warning');
    });
});

/* --- Adjust userData to include subject --- */
// (Find the existing registration handler and ensure it adds:)
//
// subject: document.getElementById('reg_subject').value,
//
// inside userData object.
/* ...existing code... */
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const reg_fname = document.getElementById('reg_fname');

        reg_fname.addEventListener('input', function(event) {
            // Replace any non-letter character with an empty string
            event.target.value = event.target.value.replace(/[^a-zA-Z]/g, '');
        });
        const reg_mname = document.getElementById('reg_mname');
        reg_mname.addEventListener('input', function(event) {
            // Replace any non-letter character with an empty string
            event.target.value = event.target.value.replace(/[^a-zA-Z]/g, '');
        });
        const reg_lname = document.getElementById('reg_lname');
        reg_lname.addEventListener('input', function(event) {
            // Replace any non-letter character with an empty string
            event.target.value = event.target.value.replace(/[^a-zA-Z]/g, '');
        }); 
    });
</script>

</body>
</html>