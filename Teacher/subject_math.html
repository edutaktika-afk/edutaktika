<script>
    document.addEventListener("DOMContentLoaded", function() {
        firebase.auth().onAuthStateChanged(async function(user) {
            if (!user) {
                window.location.href = "logreg.html";
                return;
            }
            const uid = user.uid;
            const snap = await firebase.database().ref('teachers/' + uid).once('value');
            const teacher = snap.val();
            if (!teacher || teacher.role !== "teacher") {
                document.getElementById('mainContent').style.display = "none";
                alert("Access denied.");
                await firebase.auth().signOut();
                window.location.href = "logreg.html";
            } else {
                document.getElementById('mainContent').style.display = "block";
            }
        });
    });
    </script>
    
    <!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="../CSS/fonts.css">
<!-- ...inside <head> -->
<link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="../CSS/header.css">
    <link rel="stylesheet" href="../CSS/subject.css">
    <link rel="stylesheet" href="../CSS/footer.css">
    <link rel="stylesheet" href="../CSS/dropdown.css">
    <link rel="stylesheet" href="../CSS/burger.css">
    <link rel="icon" type="image/png" href="../images/icons/math.png" />
    <title>Math</title>
    <style>
    .profile-sidebar {
    margin-top: 20px;
    max-height: 95vh;
    overflow-y: auto;
    scrollbar-width: none;         /* Firefox */
    -ms-overflow-style: none;      /* IE and Edge */
}
.profile-sidebar::-webkit-scrollbar {
    display: none;                 /* Chrome, Safari, Opera */
}

/* Force horizontal layout for quiz cards with higher specificity */
.lessons-container #student-quiz-cards,
#student-quiz-cards {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
    gap: 20px !important;
    margin-top: 20px !important;
}

/* Override the single column rule specifically for quiz cards */
.lessons-container #student-quiz-cards {
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
}

/* Ensure quiz cards maintain horizontal layout on all screen sizes */
@media (max-width: 700px) {
    .lessons-container #student-quiz-cards,
    #student-quiz-cards {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)) !important;
        gap: 15px !important;
    }
}

@media (max-width: 520px) {
    .lessons-container #student-quiz-cards,
    #student-quiz-cards {
        grid-template-columns: 1fr 1fr !important;
        gap: 12px !important;
    }
}
</style>
</head>

<body>
    <div id="mainContent" style="display:none;">
    <!-- Burger icon for mobile -->
<button id="burgerBtn" class="burger-btn" aria-label="Open menu">
    <span></span>
    <span></span>
    <span></span>
</button>
   <header>
        <div class="floating-elements">
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
            <div class="floating-element"></div>
        </div>
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <!-- Replace your logo-text div with this for per-letter bounce -->
                <div class="logo-text">
                    <span>E</span><span>d</span><span>u</span><span>t</span><span>a</span><span>k</span><span>t</span><span>i</span><span>k</span><span>a</span>
                </div>
            </div>
            <nav>
                <ul>
                    <li><a href="homepage.html">Home</a></li>
                    <li class="dropdown subject-dropdown">
      <button id="navSubjectBtn" class="dropbtn" type="button" aria-haspopup="listbox" aria-expanded="false">
        <span id="navSubjectLabel">Subject</span>
        <i class="fa fa-caret-down" aria-hidden="true" style="margin-left:6px;font-size:.75rem;"></i>
      </button>
      <ul id="navSubjectMenu" class="dropdown-content" role="listbox" aria-labelledby="navSubjectBtn">
        <li><a href="subject_math.html" data-subject="Math" role="option">Math</a></li>
        <li><a href="subject_english.html" data-subject="English" role="option">English</a></li>
        <li><a href="subject_science.html" data-subject="Science" role="option">Science</a></li>
      </ul>
    </li>
                    <li><a href="studentlist.html">Student</a></li>
                    <li class="dropdown">
                            <a href="#" class="dropbtn">Leaderboard <i class="fa fa-caret-down"></i></a>
                            <ul class="dropdown-content">
                                <li><a href="leaderboard_math.html">Math</a></li>
                                <li><a href="leaderboard_english.html">English</a></li>
                                <li><a href="leaderboard_science.html">Science</a></li>
                            </ul>
                        </li>
                    <li>
                        <a href="#" id="profileBtn"><i class="fas fa-user-circle"></i> Profile</a>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

<!-- Overlay for navbar -->
<div class="sidebar-overlay" id="navOverlay"></div>
<!-- Overlay for profile sidebar -->
<div class="sidebar-overlay" id="profileSidebarOverlay"></div>
 <!-- Profile Sidebar (Dynamic with Firebase) -->
<div id="profileSidebar" class="profile-sidebar">
    <div class="sidebar-content">
        <button class="close-btn" id="closeSidebar">&times;</button>
        <div style="position:relative; display:flex; flex-direction:column; align-items:center;">
            <img class="profile-avatar" id="profileAvatar" src="https://api.dicebear.com/7.x/bottts/svg?seed=user" alt="Profile Avatar">
            <i class="fa-solid fa-star sidebar-star" style="position:absolute; bottom:0; right:10px; color:#ffd700; font-size:1.2rem; background:white; border-radius:50%; padding:2px 4px; box-shadow:0 1px 4px #ffd70044;"></i>
        </div>
        <div class="profile-name" id="profileName">Loading...</div>
        <br>
        <div class="profile-info" style="width:100%;max-width:260px;margin-bottom:24px;">
            <div class="profile-role" style="color:#2e8b57; font-weight:700; font-size:1.1rem; margin-bottom:8px; letter-spacing:1px; text-align:center;">
            Teacher
        </div>
            <div>
                <i class="fa-solid fa-id-badge" style="color:violet;margin-right:10px;"></i>
                <strong>ID:</strong> <span id="profileId">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#ff69b4;margin-right:10px;"></i>
                <strong>First Name:</strong> <span id="profileFirstName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#ffd700;margin-right:10px;"></i>
                <strong>Middle Name:</strong> <span id="profileMiddleName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-user" style="color:#f14141;margin-right:10px;"></i>
                <strong>Last Name:</strong> <span id="profileLastName">-</span>
            </div>
            <div>
                <i class="fa-solid fa-graduation-cap" style="color:#2e8b57;margin-right:10px;"></i>
                <strong>Grade Level:</strong> <span id="profileGrade">-</span>
            </div>
            <div>
                <i class="fa-solid fa-apple-whole" style="color:#4faaff;margin-right:10px;"></i>
                <strong>Section:</strong> <span id="profileSection">-</span>
            </div>
            <div>
    <i class="fas fa-map-marker-alt" style="color:#ff69b4;margin-right:10px;"></i>
    <strong>House/Street:</strong> <span id="profileAddressStreet">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#ffd700;margin-right:10px;"></i>
    <strong>Barangay:</strong> <span id="profileAddressBarangay">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#4faaff;margin-right:10px;"></i>
    <strong>City:</strong> <span id="profileAddressCity">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#2e8b57;margin-right:10px;"></i>
    <strong>Province:</strong> <span id="profileAddressProvince">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:#f14141;margin-right:10px;"></i>
    <strong>ZIP:</strong> <span id="profileAddressZip">-</span>
</div>
<div>
    <i class="fas fa-map-marker-alt" style="color:violet;margin-right:10px;"></i>
    <strong>Region:</strong> <span id="profileAddressRegion">-</span>
</div>
        </div>
        <div class="logout-switch-row">
            <div class="logout-switch" id="logoutSwitch">
                <div class="logout-switch-circle"></div>
            </div>
            <span class="logout-label" id="logoutLabel">LOGOUT</span>
        </div>
    </div>
</div>

        <!-- Firebase App (the core Firebase SDK) -->
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
        <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

        <script src="../assets/js/Teacher Side/profile.js"></script>

    <script src="../assets/js/Teacher Side/header.js"></script>

    <div class="container">
        <!--<div class="math-header>
            <h1>Interactive Math Curriculum</h1>
            <p>Master mathematics through engaging, game-based lessons</p>
        </div>-->

        <!-- Add these buttons above your quarter navigation (inside .container) -->
        <div style="display:flex;gap:18px;margin-bottom:24px;">
            <button id="createLessonBtn" style="background:#388e3c;color:#fff;border:none;border-radius:6px;padding:10px 28px;font-size:1.1rem;font-weight:600;cursor:pointer;">
                <i class="fa fa-plus"></i> Create Lesson
            </button>
        </div>

<script src="../assets/js/editorEnv.js"></script>
<script>
// Use shared buildEditorUrl for create lesson navigation
document.getElementById('createLessonBtn')?.addEventListener('click', () => {
  window.location.href = buildEditorUrl({ subject: 'subject_math' });
});
</script>

<!-- Dropdown for mobile -->
<div class="quarter-dropdown-custom">
    <button class="quarter-dropdown-btn" id="quarterDropdownBtn">Quarter 1</button>
    <ul class="quarter-dropdown-list" id="quarterDropdownList">
        <li data-target="quarter-1" class="active">Quarter 1</li>
        <li data-target="quarter-2">Quarter 2</li>
        <li data-target="quarter-3">Quarter 3</li>
        <li data-target="quarter-4">Quarter 4</li>
        <li data-target="quarter-5">Quizzes</li>
        <li data-target="quarter-assessments">Assessments</li>
    </ul>
</div>

        <!-- Quarter Navigation -->
        <div class="quarter-nav">
            <div class="quarter-tab active" data-quarter="1">Quarter 1</div>
            <div class="quarter-tab" data-quarter="2">Quarter 2</div>
            <div class="quarter-tab" data-quarter="3">Quarter 3</div>
            <div class="quarter-tab" data-quarter="4">Quarter 4</div>
            <div class="quarter-tab" data-quarter="5" style="margin-left: auto;" >Quizzes</div>
            <div class="quarter-tab" data-quarter="assessments">Assessments</div>
        </div>

        <!-- Quarter 1 -->
        <div class="quarter-section active" id="quarter-1">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                <h2>
                    Quarter 1: 
                    <span class="bounce-word">
<span>M</span><span>a</span><span>t</span><span>h</span><span>e</span><span>m</span><span>a</span><span>t</span><span>i</span><span>c</span><span>s</span>

                    </span>
                </h2>
            </div>

            <div class="lessons-container">
                

                
            </div>

            <!-- YouTube Lessons (auto-fetched) -->
            <div id="youtube-lessons" data-playlist-id="PLlUKeoFRy2FsQc_kW5q38HD3Geb4VVQz4" style="margin-top: 20px;">
                <div class="quarter-title" style="align-items:center; gap:10px;">
                    <i class="fab fa-youtube"></i>
                    <h3 style="margin:0;">Video Lessons</h3>
                </div>
                <div class="lessons-container">
                    <div>Loading YouTube lessons…</div>
                </div>
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quarter 2 -->
        <div class="quarter-section" id="quarter-2">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                 <h2>
                    Quarter 2: 
                    <span class="bounce-word">
                        <span>M</span><span>a</span><span>t</span><span>h</span><span>e</span><span>m</span><span>a</span><span>t</span><span>i</span><span>c</span><span>s</span>

                    </span>
                </h2>
            </div>

            <div class="lessons-container">
                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quarter 3 -->
        <div class="quarter-section" id="quarter-3">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                <h2>Quarter 3:
                     <span class="bounce-word">
                        <span>M</span><span>a</span><span>t</span><span>h</span><span>e</span><span>m</span><span>a</span><span>t</span><span>i</span><span>c</span><span>s</span>

                    </span>
                </h2>
                
            </div>

            <div class="lessons-container">
                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quarter 4 -->
        <div class="quarter-section" id="quarter-4">
            <div class="quarter-title">
                <i class="fas fa-calendar-alt"></i>
                <h2>Quarter 4: 
                        <span class="bounce-word">
                            <span>M</span><span>a</span><span>t</span><span>h</span><span>e</span><span>m</span><span>a</span><span>t</span><span>i</span><span>c</span><span>s</span>
    
                        </span>
                </h2>
            </div>

            <div class="lessons-container">
                
            </div>

            <!-- <div class="progress-container">
                <div class="progress-title">Quarter Progress</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 65%"></div>
                </div>
                <div class="progress-stats">
                    <span>65% Complete</span>
                    <span>2/3 Lessons Finished</span>
                </div>
            </div>

            <div class="badges-container">
                <div class="badges-title">Earned Badges</div>
                <div class="badges-list">
                    <div class="badge" data-tooltip="Time Master">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="badge" data-tooltip="Shape Explorer">
                        <i class="fas fa-shapes"></i>
                    </div>
                </div>
            </div> -->
        </div>

        <!-- Quizzes -->
        <div class="quarter-section" id="quarter-5">
            <div class="quarter-title" style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <i class="fas fa-calendar-alt"></i>
                    <h2 style="display:inline-block;margin:0 0 0 8px;">Quizzes</h2>
                </div>
                <div style="display: flex; align-items: center;">
                    <label for="quiz-quarter-filter" style="font-weight:600; margin-right:8px;">Filter by Quarter:</label>
                    <select id="quiz-quarter-filter" style="min-width:120px;">
                        <option value="1">Quarter 1</option>
                        <option value="2">Quarter 2</option>
                        <option value="3">Quarter 3</option>
                        <option value="4">Quarter 4</option>
                    </select>
                </div>
            </div>
            <div class="lessons-container">
                <div id="quiz-list"></div>
                <div id="student-quiz-cards"></div>
            </div>
        </div>

        <!-- Assessments panel -->
        <div class="quarter-section" id="quarter-assessments">
            <div class="quarter-title">
                <i class="fas fa-clipboard-check"></i>
                <h2>Summative Assessments</h2>
            </div>
            <div class="lessons-container" id="assessmentsContainer">
                <!-- Assessment cards will be injected here -->
            </div>
        </div>
    </div>

    <script src="../assets/js/Teacher Side/subject.js"></script>

    <script>
    // --- Inject Assessment Card for Math ---
    (function(){
        const container = document.getElementById('assessmentsContainer');
        if(!container) return;
        
        // Ensure the container has the proper grid styling
        container.style.display = 'grid';
        container.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
        container.style.gap = '20px';
        container.style.marginBottom = '30px';

        // Create Assessment 1 card for Math
        const card = document.createElement('div');
        card.className = 'lesson-item clickable-card';
        card.setAttribute('tabindex','0');
        card.setAttribute('role','button');
        card.setAttribute('aria-label','Open Assessment 1: Everyday Math');
        card.innerHTML = `
            <div class="lesson-thumbnail" style="background-color: var(--peach);display:flex;align-items:center;justify-content:center;font-size:42px;color:#fff;">A1</div>
            <div class="lesson-title">
                <h3>Assessment 1: Everyday Math</h3>
                <p>10-item real‑life math skills check.</p>
                <span class="lesson-badge" style="cursor:pointer;" data-action="start">Start</span>
                <div style="margin-top:8px;font-size:0.9rem;color:#444;" id="a1LastScore">Last Score: -</div>
            </div>`;
        container.appendChild(card);
        card.addEventListener('click', (e)=>{
            if(e.target.closest('[data-action="start"]')) { window.location.href='../Games/Assessment/Assexam.html'; return; }
            window.location.href='../Games/Assessment/Assexam.html';
        });
        card.addEventListener('keydown', (e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); window.location.href='../Games/Assessment/Assexam.html'; }});

        // Fetch last score if user logged in
        firebase.auth().onAuthStateChanged(function(user){
            if(!user) return;
            const uid = user.uid;
            firebase.database().ref('assessmentScores/assessment1/' + uid).orderByChild('timestamp').limitToLast(1).once('value', snap => {
                if(!snap.exists()) return;
                let val; snap.forEach(c=> val = c.val ? c.val() : c); // handle object or direct
                const dataObj = (typeof val === 'object') ? val : null;
                const scoreEl = document.getElementById('a1LastScore');
                if(scoreEl && dataObj) {
                    scoreEl.textContent = `Last Score: ${dataObj.score}/${dataObj.total} (${dataObj.percentage}%)`;
                } else if(scoreEl && !dataObj){
                    // If stored as direct leaf (score object)
                    const raw = snap.val();
                    if(raw && raw.score !== undefined) {
                        scoreEl.textContent = `Last Score: ${raw.score}/${raw.total} (${raw.percentage}%)`;
                    }
                }
            });
        });
    })();

    // --- Add Student Quiz Cards to existing Quizzes section ---
    (function(){
        const container = document.getElementById('student-quiz-cards');
        if(!container) return;
        
        // Ensure the container has proper grid styling for horizontal layout
        container.style.display = 'grid';
        container.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
        container.style.gap = '20px';
        container.style.marginTop = '20px';
        
        // Override any CSS that might force single column layout
        container.style.setProperty('grid-template-columns', 'repeat(auto-fit, minmax(300px, 1fr))', 'important');
        container.style.setProperty('gap', '20px', 'important');
        container.style.setProperty('display', 'grid', 'important');
        
        // Force the parent lessons-container to not interfere
        const parentContainer = container.closest('.lessons-container');
        if (parentContainer) {
            parentContainer.style.setProperty('display', 'block', 'important');
        }

        // Create Quiz 1: Time & Time Zones
        const quiz1 = document.createElement('div');
        quiz1.className = 'lesson-item clickable-card';
        quiz1.setAttribute('tabindex','0');
        quiz1.setAttribute('role','button');
        quiz1.innerHTML = `
            <div class="lesson-thumbnail" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-clock" style="font-size: 2.5rem; color: white;"></i>
            </div>
            <div class="lesson-title">
                <h3>Quiz 1: Math - Time & Time Zones</h3>
                <p>Test your understanding of time and time zones.</p>
                <span class="lesson-badge" style="cursor:pointer;" data-action="start">Start</span>
                <div style="margin-top:8px;font-size:0.9rem;color:#444;" id="mathQuiz1LastScore">Last Score: -</div>
            </div>`;
        container.appendChild(quiz1);
        quiz1.addEventListener('click',(e)=>{
            if(e.target.closest('[data-action="start"]')) { window.location.href='../Games/Quiz/lesson1.html'; return; }
            window.location.href='../Games/Quiz/lesson1.html';
        });
        quiz1.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); window.location.href='../Games/Quiz/lesson1.html'; }});

        // Create Quiz 2: Clock Setting
        const quiz2 = document.createElement('div');
        quiz2.className = 'lesson-item clickable-card';
        quiz2.setAttribute('tabindex','0');
        quiz2.setAttribute('role','button');
        quiz2.innerHTML = `
            <div class="lesson-thumbnail" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-clock" style="font-size: 2.5rem; color: white;"></i>
            </div>
            <div class="lesson-title">
                <h3>Quiz 2: Math - Clock Setting</h3>
                <p>Practice setting clocks and reading time.</p>
                <span class="lesson-badge" style="cursor:pointer;" data-action="start">Start</span>
                <div style="margin-top:8px;font-size:0.9rem;color:#444;" id="mathQuiz2LastScore">Last Score: -</div>
            </div>`;
        container.appendChild(quiz2);
        quiz2.addEventListener('click',(e)=>{
            if(e.target.closest('[data-action="start"]')) { window.location.href='../Games/Quiz/clock-quiz.html'; return; }
            window.location.href='../Games/Quiz/clock-quiz.html';
        });
        quiz2.addEventListener('keydown',(e)=>{ if(e.key==='Enter'||e.key===' '){ e.preventDefault(); window.location.href='../Games/Quiz/clock-quiz.html'; }});

        // Load quiz scores for teachers
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                const uid = user.uid;
                
                // Load Quiz 1 score
                firebase.database().ref('quizSummaries/lesson1/' + uid).once('value', snap => {
                    if (snap.exists()) {
                        const data = snap.val();
                        const lastAttempt = Object.values(data).sort((a, b) => b.timestamp - a.timestamp)[0];
                        if (lastAttempt) {
                            document.getElementById('mathQuiz1LastScore').textContent = `Last Score: ${lastAttempt.score}/${lastAttempt.total}`;
                        }
                    }
                });

                // Load Quiz 2 score
                firebase.database().ref('quizSummaries/clock-quiz/' + uid).once('value', snap => {
                    if (snap.exists()) {
                        const data = snap.val();
                        const lastAttempt = Object.values(data).sort((a, b) => b.timestamp - a.timestamp)[0];
                        if (lastAttempt) {
                            document.getElementById('mathQuiz2LastScore').textContent = `Last Score: ${lastAttempt.score}/${lastAttempt.total}`;
                        }
                    }
                });
            }
        });
    })();
    </script>


<footer>
  <div class="footer-wrap">
    <div class="footer-col">
      <h4 class="footer-brand">Eduktaktika</h4>
      <p>Interactive, game‑based learning for Math, English, and Science.</p>
    </div>
    <div class="footer-col">
      <h4>Connect</h4>
      <ul class="footer-social">
        <li><a href="homepage.html">Homepage</a></li>
        <li><a href="studentlist.html">Student</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Subjects</h4>
      <ul class="footer-links">
        <li><a href="subject_math.html">Math</a></li>
        <li><a href="subject_english.html">English</a></li>
        <li><a href="subject_science.html">Science</a></li>
      </ul>
    </div>
    <div class="footer-col">
      <h4>Leaderboards</h4>
      <ul class="footer-links">
        <li><a href="leaderboard_math.html">Math</a></li>
        <li><a href="leaderboard_english.html">English</a></li>
        <li><a href="leaderboard_science.html">Science</a></li>
      </ul>
    </div>
  </div>
  <div class="footer-bottom">
    <div class="footer-social-row">
      <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
      <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
      <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
      <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
    </div>
    <p>© 2025 Eduktaktika. All rights reserved.</p>
  </div>
</footer>


<script src="../assets/js/Teacher Side/editProfile.js"></script>
<script>
// Wait for authentication
firebase.auth().onAuthStateChanged(async function(user) {
    if (user) {
        const teacherUID = user.uid;
        // Get teacher's section
        const teacherSnap = await db.ref('teachers/' + teacherUID).once('value');
        const teacher = teacherSnap.val();
        if (!teacher || !teacher.section) {
            alert("Your section is not set. Please update your profile.");
            
            return;
        }
        const section = teacher.section;

        // For each quarter, load only this teacher's section lessons
        for (let q = 1; q <= 4; q++) {
            db.ref('teachers/' + teacherUID + '/sections/' + section + '/lessons/' + subjectPage + '/quarter-' + q)
                .once('value', function(snapshot) {
                    const container = document.querySelector(`#quarter-${q} .lessons-container`);
                    if (!container) return;
                    container.innerHTML = '';
                    if (!snapshot.exists()) {
                        
                        return;
                    }
                    snapshot.forEach(function(child) {
                        const data = child.val();
                        const name = child.key;
                        const item = document.createElement('div');
                        item.className = 'lesson-item';
                        item.setAttribute('data-presentation', name);
                        item.innerHTML = `
                            <div class="lesson-thumbnail" style="background-color: var(--peach)"></div>
                            <div class="lesson-title">
                                <h3>${data.title || name}</h3>
                                <p>${data.description ? data.description : ''}</p>
                                <span class="lesson-badge" onclick="viewPresentation('${q}','${name}','view','${subjectPage}')" style="cursor:pointer;">View</span>
                                <button class="lesson-badge" onclick="viewPresentation('${q}','${name}','edit','${subjectPage}')" style="cursor:pointer;">Edit</button>
                            </div>
                        `;
                        container.appendChild(item);
                    });
                });
        }
    }
});


</script>

<style>
    #createLessonModal {
        display: none;
        position: fixed;
        top: 0; left: 0; width: 100vw; height: 100vh;
        background: rgba(0,0,0,0.35);
        z-index: 99999;
        align-items: center;
        justify-content: center;
    }
    #createLessonModal .modal-content {
        background: #fff;
        padding: 32px 28px;
        border-radius: 16px;
        max-width: 370px;
        width: 90%;
        box-shadow: 0 4px 24px #0002;
        text-align: left;
        position: relative;
        animation: modalPop 0.25s;
    }
        @keyframes modalPop {
        0% { transform: scale(0.95); opacity: 0; }
        100% { transform: scale(1); opacity: 1; }
    }
    #createLessonModal h3 {
        margin-top: 0;
        margin-bottom: 18px;
        font-size: 1.35rem;
        color: #059981;
        letter-spacing: 1px;
    }
    #createLessonModal label {
        font-weight: 500;
        color: #2d3923;
        font-size: 1rem;
    }
    #createLessonModal input, #createLessonModal select, #createLessonModal textarea {
        width: 100%;
        padding: 8px 10px;
        margin-top: 4px;
        margin-bottom: 12px;
        border: 1px solid #b2b2b2;
        border-radius: 6px;
        font-size: 1rem;
        background: #f8f8f8;
        transition: border 0.2s;
    }
    #createLessonModal input:focus, #createLessonModal select:focus, #createLessonModal textarea:focus {
        border: 1.5px solid #059981;
        outline: none;
        background: #fff;
    }
    #createLessonModal .modal-actions {
        text-align: right;
        margin-top: 10px;
    }
    #createLessonModal button[type="button"] {
        background: #eee;
        color: #333;
        border: none;
        border-radius: 6px;
        padding: 8px 18px;
        font-size: 1rem;
        margin-right: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    #createLessonModal button[type="button"]:hover {
        background: #e0e0e0;
    }
    #createLessonModal button[type="submit"] {
        background: #059981;
        color: #fff;
        border: none;
        border-radius: 6px;
        padding: 8px 22px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }
    #createLessonModal button[type="submit"]:hover {
        background: #037a65;
    }
</style>


<div id="createLessonModal" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(0,0,0,0.35);z-index:99999;align-items:center;justify-content:center;">
    <div style="background:#fff;padding:32px 28px;border-radius:14px;max-width:350px;width:90%;box-shadow:0 4px 24px #0002;text-align:left;position:relative;">
        <h3 style="margin-top:0;">Create New Lesson</h3>
        <form id="createLessonForm">
            <label>Quarter:<br>
                <select id="lesson_quarter" required>
                    <option value="">Select Quarter</option>
                    <option value="1">Quarter 1</option>
                    <option value="2">Quarter 2</option>
                    <option value="3">Quarter 3</option>
                    <option value="4">Quarter 4</option>
                </select>
            </label><br><br>
            <label>Title:<br>
                <input type="text" id="lesson_title" required>
            </label><br><br>
            <label>Description:<br>
                <textarea id="lesson_desc" rows="2"></textarea>
            </label><br><br>
            <div style="text-align:right;">
                <button type="button" onclick="closeCreateLessonModal()" style="margin-right:10px;">Cancel</button>
                <button type="submit">Start</button>
            </div>
        </form>
    </div>
</div>

<script>
    // Place this script after your modal HTML

// Create Lesson click handled earlier by Netlify-aware script block (removed duplicate handler here)

// Hide modal function
function closeCreateLessonModal() {
    document.getElementById('createLessonModal').style.display = 'none';
}

// Set the subject page variable based on the current page
const subjectPage = "subject_math";
document.getElementById('createLessonForm').onsubmit = async function(e) {
    e.preventDefault();
    const quarter = document.getElementById('lesson_quarter').value;
    const title = document.getElementById('lesson_title').value.trim();
    const desc = document.getElementById('lesson_desc').value.trim();

    if (!quarter || !title) {
        alert('Quarter and Title are required!');
        return;
    }

    const user = firebase.auth().currentUser;
    const teacherUID = user.uid;

    // Get teacher's section from database
    const teacherSnap = await db.ref('teachers/' + teacherUID).once('value');
    const teacher = teacherSnap.val();
    if (!teacher || !teacher.section) {
        alert("Your section is not set. Please update your profile.");
        return;
    }
    const section = teacher.section;

    const blankSlide = JSON.stringify([{
        version: "5.2.4",
        objects: [],
        backgroundColor: "#fff"
    }]);

    const lessonData = {
        slides: blankSlide,
        title: title,
        quarter: quarter,
        description: desc,
        savedAt: new Date().toISOString()
    };



    // ALSO save to the section-specific path for student loading:
    db.ref('teachers/' + teacherUID + '/sections/' + section + '/lessons/' + subjectPage + '/quarter-' + quarter + '/' + title).set(lessonData, function(error) {
        if (error) {
            alert('Error creating lesson: ' + error.message);
        } else {
            document.getElementById('lesson_quarter').value = '';
            document.getElementById('lesson_title').value = '';
            document.getElementById('lesson_desc').value = '';
            closeCreateLessonModal();

            // Environment-aware redirect to Editor build (dev vs production)
            const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(title)}&desc=${encodeURIComponent(desc)}&subject=${encodeURIComponent(subjectPage)}`;
            window.location.href = buildEditorUrl({
                quarter,
                name: title,
                desc,
                subject: subjectPage
            });
        }
    });
};
</script>

<script>

firebase.auth().onAuthStateChanged(async function(user) {
    if (!user) return;
    const teacherUID = user.uid;
    const teacherSnap = await db.ref('teachers/' + teacherUID).once('value');
    const teacher = teacherSnap.val();
    const section = teacher && teacher.section ? teacher.section : null;

    for (let q = 1; q <= 4; q++) {
        const container = document.querySelector(`#quarter-${q} .lessons-container`);
        if (!container) continue;

        // Fetch ONLY teacher's own lessons
        let lessons = [];
        if (section) {
            const teacherLessonsSnap = await db.ref('teachers/' + teacherUID + '/sections/' + section + '/lessons/' + subjectPage + '/quarter-' + q).once('value');
            if (teacherLessonsSnap.exists()) {
                teacherLessonsSnap.forEach(child => {
                    const data = child.val();
                    lessons.push({
                        title: data.title || child.key,
                        description: data.description || ''
                    });
                });
            }
        }

        // Sort lessons alphabetically by title
        lessons.sort((a, b) => a.title.localeCompare(b.title));

        // Render lessons
        if (lessons.length === 0) {
            
        } else {
            container.innerHTML = lessons.map(lesson => `
                <div class="lesson-item" data-presentation="${lesson.title}">
                    <div class="lesson-thumbnail" style="background-color: var(--peach)"></div>
                    <div class="lesson-title">
                        <h3>${lesson.title}</h3>
                        <p>${lesson.description}</p>
                        <button class="lesson-badge" onclick="viewPresentation('${q}','${lesson.title}','view','${subjectPage}')" style="cursor:pointer;">View</button>
                        <button class="lesson-badge" onclick="viewPresentation('${q}','${lesson.title}','edit','${subjectPage}')" style="cursor:pointer;">Edit</button>
                    </div>
                </div>
            `).join('');
        }
    }
});
function viewPresentation(quarter, name, mode = 'view', subject = subjectPage) {
    const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(name)}&subject=${encodeURIComponent(subject)}`;
    if (mode === 'edit') {
    window.location.href = buildEditorUrl({ quarter, name, subject });
    } else {
        window.location.href = 'present.html?' + params;
    }
}
</script>


<script>

// Load quizzes for the selected quarter under the teacher's section
async function loadTeacherQuizzes(quarter) {
    const quizList = document.getElementById('quiz-list');
    quizList.innerHTML = '<div style="color:#888;">Loading...</div>';

    const user = firebase.auth().currentUser;
    if (!user) {
        quizList.innerHTML = "<div>Please log in to view your quizzes.</div>";
        return;
    }

    // Get teacher's section
    const teacherSnap = await db.ref('teachers/' + user.uid).once('value');
    const teacher = teacherSnap.val();
    if (!teacher || !teacher.section) {
        quizList.innerHTML = "<div>No section found for this teacher.</div>";
        return;
    }
    const section = teacher.section;

    // Load quizzes from teacher's section
    const snap = await db.ref('teachers/' + user.uid + '/sections/' + section + '/quizzes/' + subjectPage + '/' + quarter).once('value');
    if (!snap.exists()) {
        quizList.innerHTML = "<div>No quizzes found for this quarter.</div>";
        return;
    }
    let quizzes = [];
    snap.forEach(child => {
        const data = child.val();
        quizzes.push({
            title: data.title || child.key,
            description: data.description || '',
            quarter: data.quarter || quarter,
            savedAt: data.savedAt || ""
        });
    });
     // Sort quizzes by savedAt (old to new)
    quizzes.sort((a, b) => new Date(a.savedAt) - new Date(b.savedAt));
    quizList.innerHTML = `
        <div style="display: flex; flex-wrap: nowrap; gap: 18px;">
            ${quizzes.map(quiz => `
                <div class="lesson-item" data-quiz="${quiz.title}">
                    <div class="lesson-thumbnail" style="background-color: #ffdd01"></div>
                    <div class="lesson-title">
                        <h3>${quiz.title}</h3>
                        <p>${quiz.description}</p>
                        <button class="lesson-badge" onclick="viewQuiz('${quiz.quarter}','${quiz.title}','view','${subjectPage}')" style="cursor:pointer;">View</button>
                        <button class="lesson-badge" onclick="viewQuiz('${quiz.quarter}','${quiz.title}','edit','${subjectPage}')" style="cursor:pointer;">Edit</button>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}
// Listen for auth and filter changes
firebase.auth().onAuthStateChanged(function(user) {
    const filter = document.getElementById('quiz-quarter-filter');
    if (!filter) return;
    filter.value = '1';
    if (user) {
        loadTeacherQuizzes('1');
        filter.disabled = false;
        filter.onchange = function() {
            loadTeacherQuizzes(this.value);
        };
    } else {
        document.getElementById('quiz-list').innerHTML = "<div>Please log in to view your quizzes.</div>";
        filter.disabled = true;
    }
});

// Helper for view/edit
function viewQuiz(quarter, name, mode = 'view', subject = subjectPage) {
    const params = `quarter=${encodeURIComponent(quarter)}&name=${encodeURIComponent(name)}&subject=${encodeURIComponent(subject)}`;
    if (mode === 'edit') {
        window.location.href = 'quizEditor.html?' + params;
    } else {
        window.location.href = 'quizView.html?' + params;
    }
}


</script>


<style>
        #quiz-list {
        display: flex;
        flex-wrap: wrap;
        gap: 18px;
        justify-content: flex-start;
        align-items: stretch;
        margin-top: 10px;
    }
    .lesson-item {
        flex: 1 1 260px;
        min-width: 220px;
        max-width: 320px;
        box-sizing: border-box;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 12px #0001;
        padding: 18px 14px 14px 14px;
        display: flex;
        flex-direction: column;
        align-items: stretch;
        margin-bottom: 8px;
    }
    .lesson-thumbnail {
        width: 100%;
        height: 80px;
        border-radius: 8px;
        margin-bottom: 12px;
        background-size: cover;
        background-position: center;
    }
    .lesson-title h3 {
        font-size: 1.15rem;
        margin: 0 0 6px 0;
    }
    .lesson-title p {
        font-size: 0.98rem;
        color: #444;
        margin: 0 0 10px 0;
    }
    .lesson-badge {
        background: #ffe600;
        color: #222;
        border: none;
        border-radius: 6px;
        padding: 7px 18px;
        font-size: 1rem;
        font-weight: 600;
        margin-right: 8px;
        cursor: pointer;
        transition: background 0.2s;
    }
    .lesson-badge:hover {
        background: #ffd600;
    }
</style>

<script>
    // Show modal on Create Quiz click

</script>

<script>
// Load latest YouTube videos via playlist RSS feed into Quarter 1 (Teacher) - English
async function loadYouTubeVideosTeacher() {
    const wrapper = document.getElementById('youtube-lessons');
    const container = document.querySelector('#youtube-lessons .lessons-container');
    if (!container || !wrapper) return;
    const playlistId = (wrapper.dataset.playlistId || '').trim();
    if (!playlistId) {
        container.innerHTML = '<div style="color:#888;">Set a YouTube playlist ID to load videos.</div>';
        return;
    }
    const feedUrl = `https://www.youtube.com/feeds/videos.xml?playlist_id=${encodeURIComponent(playlistId)}`;

    async function fetchWithCors(url) {
        try {
            const r = await fetch(url);
            if (r.ok) return await r.text();
            throw new Error('HTTP ' + r.status);
        } catch {
            try {
                const rAO = await fetch('https://api.allorigins.win/raw?url=' + encodeURIComponent(url));
                if (rAO.ok) return await rAO.text();
                throw new Error();
            } catch {
                const jinaUrl = 'https://r.jina.ai/http/' + url.replace(/^https?:\/\//i, '');
                const rJ = await fetch(jinaUrl);
                if (rJ.ok) return await rJ.text();
                throw new Error('All fetch attempts failed');
            }
        }
    }

    try {
        const xmlText = await fetchWithCors(feedUrl);
        const parser = new DOMParser();
        const doc = parser.parseFromString(xmlText, 'text/xml');
        const entries = Array.from(doc.getElementsByTagName('entry'));
        container.innerHTML = '';

        const YT_NS = 'http://www.youtube.com/xml/schemas/2015';
        const mathKeywords = ['math', 'mathematics', 'number', 'addition', 'subtraction', 'multiplication', 'division', 'fraction', 'decimal', 'geometry', 'algebra', 'equation', 'problem', 'solve', 'calculate', 'gmdas', 'clock', 'time', 'measurement', 'sequence', 'operation', 'counting', 'place value', 'rounding', 'percentage', 'ratio', 'proportion', 'angle', 'triangle', 'circle', 'square', 'rectangle', 'area', 'perimeter', 'volume', 'statistics', 'graph', 'chart', 'data', 'pattern', 'logic', 'reasoning'];

        const filteredEntries = entries.filter(entry => {
            const titleEl = entry.getElementsByTagName('title')[0];
            const title = titleEl ? (titleEl.textContent || '').toLowerCase() : '';
            return mathKeywords.some(k => title.includes(k));
        });

        // Sort all entries by published date (chronological order - newest first)
        const sortedEntries = (filteredEntries.length ? filteredEntries : entries).sort((a, b) => {
            const dateA = new Date(a.getElementsByTagName('published')[0]?.textContent || 0);
            const dateB = new Date(b.getElementsByTagName('published')[0]?.textContent || 0);
            return dateB - dateA; // Newest first
        });

        // Show all videos (remove the .slice(0,5) limit)
        const videosToShow = sortedEntries;

        videosToShow.forEach(entry => {
            const vidEl = entry.getElementsByTagNameNS?.(YT_NS,'videoId')?.[0]
                || entry.getElementsByTagName('yt:videoId')?.[0]
                || entry.querySelector('yt\\:videoId, videoId');
            const titleEl = entry.getElementsByTagName('title')[0];
            const publishedEl = entry.getElementsByTagName('published')[0];
            const videoId = vidEl ? (vidEl.textContent || '').trim() : '';
            if(!videoId) return;
            const title = titleEl ? (titleEl.textContent || 'YouTube Video').trim() : 'YouTube Video';
            const publishedDate = publishedEl ? new Date(publishedEl.textContent).toLocaleDateString() : '';
            const watchUrl = `video.html?id=${encodeURIComponent(videoId)}&title=${encodeURIComponent(title)}`;

            const card = document.createElement('div');
            card.className = 'lesson-item video-card';
            card.setAttribute('data-watch-url', watchUrl);

            card.innerHTML = `
                <div class="video-embed clickable-overlay" style="position:relative;width:100%;padding-top:56.25%;border-radius:10px;overflow:hidden;margin-bottom:12px;background:#000;">
                    <img src="https://i.ytimg.com/vi/${videoId}/hqdefault.jpg" alt="${title.replace(/"/g,'&quot;')}" 
                         style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;">
                    <div class="play-badge" aria-hidden="true">▶</div>
                </div>
                <div class="lesson-title">
                    <h3>${title}</h3>
                    <p style="font-size:0.9rem;color:#666;margin:4px 0;">Published: ${publishedDate}</p>
                    <button class="lesson-badge watch-btn" type="button">Watch</button>
                </div>
            `;

            // Click handlers (whole card)
            card.addEventListener('click', (e) => {
                // Prevent double if button
                if (e.target.closest('.watch-btn')) {
                    window.location.href = watchUrl;
                    return;
                }
                // Ignore text selection drag
                if (window.getSelection && window.getSelection().toString().length) return;
                window.location.href = watchUrl;
            });

            container.appendChild(card);
        });

        if(!container.children.length){
            container.innerHTML = '<div>No videos found.</div>';
        }
    } catch(err){
        console.error(err);
        container.innerHTML = '<div>Failed to load videos.</div>';
    }
}
document.addEventListener('DOMContentLoaded', loadYouTubeVideosTeacher);

</script>
<script src="../assets/js/navbar.js"></script>
<script src="../assets/tabDropdown.js"></script>
<script src="../assets/js/header-dynamic-labels.js"></script>
<!-- Empty quarter placeholder styles & logic -->
<style>
    .empty-quarter-msg {
        box-sizing: border-box;
        width: 100%;
        padding: 26px 20px;
        margin: 6px 0 14px 0;
        border: 2px dashed #bbb;
        border-radius: 14px;
        background: #fafafa;
        font-size: 0.95rem;
        line-height: 1.45;
        text-align: center;
        color: #333;
        font-weight: 600;
        letter-spacing: .4px;
        position: relative;
        animation: fadeInEmpty .4s ease;
    }
    .empty-quarter-msg:before {
        content: "";
        position: absolute;
        inset: 4px;
        border-radius: 10px;
        background: repeating-linear-gradient(45deg,#00000006 0 10px,transparent 10px 20px);
        pointer-events: none;
        z-index: 0;
    }
    .empty-quarter-msg > * { position: relative; z-index: 1; }
    @keyframes fadeInEmpty { from { opacity:0; transform: translateY(4px);} to { opacity:1; transform: translateY(0);} }
    .empty-quarter-msg strong { color:#059981; }
    @media (prefers-color-scheme: dark) {
        .empty-quarter-msg { background:#1e1e1e; border-color:#444; color:#ddd; }
        .empty-quarter-msg strong { color:#4dd6c3; }
    }
</style>
<script>
(function(){
    const QUARTER_SELECTOR = '.quarter-section';
    const IGNORE_IDS = new Set(['quarter-5','quarter-assessments']);
    const quarterSections = Array.from(document.querySelectorAll(QUARTER_SELECTOR)).filter(sec=> !IGNORE_IDS.has(sec.id));

    function sectionHasLessonCards(section){
        // Any authored lesson or quiz style card
        const cards = section.querySelectorAll('.lessons-container .lesson-item');
        // Exclude video cards check separately
        return cards.length > 0;
    }
    function sectionHasVideoCards(section){
        if(section.id !== 'quarter-1') return false; // only quarter 1 hosts YouTube block
        const vidContainer = section.querySelector('#youtube-lessons .lessons-container');
        if(!vidContainer) return false;
        return !!vidContainer.querySelector('.video-card');
    }
    function removePlaceholder(section){
        const el = section.querySelector('.empty-quarter-msg');
        if(el) el.remove();
    }
    function addPlaceholder(section){
        if(section.querySelector('.empty-quarter-msg')) return; // already present
        const firstContainer = section.querySelector('.lessons-container');
        const host = firstContainer || section;
        const div = document.createElement('div');
        div.className = 'empty-quarter-msg';
        div.innerHTML = '<strong>No lessons available yet.</strong><br><span style="font-weight:400;">Click the "Create Lesson" button to add one.</span>';
        host.appendChild(div);
    }
    function evaluate(section){
        if(sectionHasLessonCards(section) || sectionHasVideoCards(section)){
            removePlaceholder(section);
        } else {
            addPlaceholder(section);
        }
    }

    // Initial evaluation (after DOM paint but before async Firebase completes)
    quarterSections.forEach(sec=> evaluate(sec));

    // Observe each lessons container for changes
    const obsConfig = { childList: true }; // we only care about direct children (cards)
    const observer = new MutationObserver(mutations => {
        // Collect unique quarter sections touched
        const touched = new Set();
        mutations.forEach(m => {
            const sec = m.target.closest('.quarter-section');
            if(sec && !IGNORE_IDS.has(sec.id)) touched.add(sec);
        });
        touched.forEach(sec => evaluate(sec));
    });

    quarterSections.forEach(sec => {
        // Observe every lessons-container inside the section (main + youtube sub)
        sec.querySelectorAll('.lessons-container').forEach(c => observer.observe(c, obsConfig));
    });

    // Safety re-checks after typical async operations (Firebase & YouTube fetch)
    [1500, 3000, 6000].forEach(delay => setTimeout(()=> quarterSections.forEach(evaluate), delay));
})();
</script>
    </div>
</body>

</html>