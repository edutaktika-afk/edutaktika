<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Short Answer Quiz</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root{
  --bg:#f1f6fb;
  --card:#ffffff;
  --accent:#2563eb;
  --danger:#d94848;
  --muted:#5b6b7c;
}
*{box-sizing:border-box;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
html,body,#embedRoot{height:100%;width:100%;margin:0;padding:0;overflow:hidden;background:var(--bg);}
body{display:flex;align-items:center;justify-content:center;}
#embedRoot{
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
  height: 100%;
  width: 100%;
}
.quiz-scale{
  /* Remove absolute + translate; center via flex parent */
  position:static;
  display:flex;
  align-items:center;
  justify-content:center;
  transform-origin:50% 50%;
  will-change:transform;
}
.quiz-wrap{
  width:750px;max-width:750px;
  background:var(--card);
  padding:40px 44px 46px;
  border-radius:30px;
  box-shadow:0 26px 86px -22px rgba(20,45,70,.35);
  display:flex;
  flex-direction:column;
  gap:26px;
  position:relative;
}
h1{margin:0;font-size:2rem;color:#12344d;text-align:center;font-weight:700;}
#questionText{font-size:1.15rem;font-weight:600;line-height:1.4;color:#13384d;min-height:64px;text-align:center;margin:0;}
.answer-box{display:flex;flex-direction:column;gap:14px;align-items:stretch}
.answer-box input[type=text]{
  width:100%;padding:16px 18px;font-size:1rem;
  border:2px solid #d4e1ec;background:#fff;border-radius:16px;
  outline:none;transition:.18s;
}
.answer-box input[type=text]:focus{border-color:var(--accent);background:#f6faff}
.controls{display:flex;justify-content:center;gap:16px;flex-wrap:wrap}
button{cursor:pointer;font-weight:600;font-size:1rem}
#nextBtn,#finishBtn{
  background:var(--accent);
  color:#fff;
  border:0;
  padding:14px 30px;
  border-radius:18px;
  box-shadow:0 6px 22px -8px rgba(37,99,235,.45);
  font-weight:600;
  font-size:1rem;
  cursor:pointer;
  transition:.22s;
  /* NEW hidden baseline: keep space reserved */
  visibility:hidden;
  opacity:0;
  transform:translateY(6px);
  pointer-events:none;
}
#nextBtn:hover,#finishBtn:hover{background:#1d56cc}

/* When active (shown) */
#nextBtn.active,#finishBtn.active{
  visibility:visible;
  opacity:1;
  transform:translateY(0);
  pointer-events:auto;
  align-items: center;
  margin-left: 100px;
}

/* Keep controls container height constant to avoid layout shift */
.controls{
  display:flex;
  justify-content:center;
  gap:16px;
  flex-wrap:wrap;
  min-height:60px; /* reserve space */
  position:relative;
}
#editOpen{
  position:absolute;top:14px;right:14px;
  background:#fff;border:1px solid #c5d5e1;color:#174369;
  padding:7px 16px;font-size:.75rem;border-radius:12px;
}
#editOpen:hover{background:#f2f8fc}
#progress{height:10px;width:100%;background:#e5edf3;border-radius:8px;overflow:hidden}
#bar{height:100%;width:0;background:linear-gradient(90deg,#2563eb,#4f8dfd)}
/* Final modal */
.modal{position:fixed;inset:0;background:rgba(15,35,55,.55);display:none;align-items:center;justify-content:center;padding:28px;z-index:400}
.modal-card{background:#fff;width:min(520px,94%);padding:50px 52px 56px;border-radius:34px;text-align:center;box-shadow:0 34px 96px -28px rgba(15,35,55,.55);display:flex;flex-direction:column;gap:30px}
.modal-card h2{margin:0;font-size:2.2rem;color:#153a55}
.primary{background:var(--accent);color:#fff;border:0;padding:14px 34px;font-size:1.05rem;border-radius:20px}
.primary:hover{background:#1d56cc}
/* Editor */
#editorModal{position:fixed;inset:0;background:rgba(10,25,45,.55);display:none;align-items:center;justify-content:center;padding:28px;z-index:450}
#editorCard{
  background:#fff;width:min(980px,96%);max-height:92vh;overflow:auto;
  border-radius:32px;padding:40px 46px 48px;
  display:flex;flex-direction:column;gap:30px;
  box-shadow:0 38px 110px -32px rgba(10,30,60,.55)
}
.editor-flex{display:flex;gap:34px;flex-wrap:wrap}
.col{flex:1 1 380px;min-width:320px;display:flex;flex-direction:column;gap:16px}
label.small{font-size:.65rem;font-weight:700;letter-spacing:.8px;text-transform:uppercase;color:#436177}
textarea,input[type=text]{width:100%;border:1px solid #c2d4e1;border-radius:14px;padding:12px 14px;font-size:.9rem;font-family:inherit;resize:vertical}
.q-list{border:1px solid #d5e2ec;border-radius:22px;padding:18px 20px;display:flex;flex-direction:column;gap:12px;max-height:460px;overflow:auto}
.qrow{padding:12px 14px;border:1px solid #d9e5ef;border-radius:16px;background:#f6fbfe;display:flex;flex-direction:column;gap:8px;position:relative}
.qrow.active{outline:2px solid var(--accent);background:#eef6ff}
.qrow button{align-self:flex-start;background:#fff;border:1px solid #c5d5e3;font-size:.65rem;padding:5px 10px;border-radius:8px}
.qrow button:hover{background:#e8f2fa}
.choice-row{display:flex;gap:10px;align-items:center}
.inline{display:flex;gap:6px;flex-wrap:wrap}
.editor-actions{display:flex;gap:12px;flex-wrap:wrap}
.editor-actions button{background:var(--accent);color:#fff;border:0;padding:12px 20px;font-weight:600;border-radius:14px;font-size:.85rem;cursor:pointer}
.editor-actions button.secondary{background:#e4edf4;color:#18425f}
.editor-actions button.secondary:hover{background:#d7e7f2}
.status{font-size:.75rem;min-height:18px;font-weight:600}
.addBtn{background:var(--accent);color:#fff;border:0;padding:9px 16px;font-size:.7rem;font-weight:600;border-radius:10px;cursor:pointer}
.addBtn:hover{background:#1d56cc}
::-webkit-scrollbar{width:0;height:0}
</style>
</head>
<body>
<div id="embedRoot">
  <div class="quiz-scale">
    <div class="quiz-wrap">
      <button id="editOpen">Edit</button>
      <h1>Short Answer Quiz</h1>
      <div id="progress"><div id="bar"></div></div>
      <div id="questionText"></div>
      <div class="answer-box">
        <input id="answerInput" type="text" placeholder="Type your answer and press Enter or click Next..." autocomplete="off">
      </div>
      <div class="controls">
        <button id="nextBtn">Next</button>
        <button id="finishBtn">Finish</button>
      </div>
    </div>
  </div>
</div>

<!-- Final Modal -->
<div class="modal" id="finalModal" aria-hidden="true">
  <div class="modal-card">
    <h2>Thank You!</h2>
    <p id="finalMsg" style="margin:0;font-size:1.05rem;color:#42596b">Your answers have been submitted.</p>
    <button class="primary" id="restartBtn">Play Again</button>
  </div>
</div>

<!-- Editor Modal -->
<div id="editorModal" aria-hidden="true">
  <div id="editorCard">
    <h2 style="margin:0 0 -4px;font-size:1.7rem;color:#153b56">Edit Questions</h2>
    <div class="editor-flex">
      <div class="col">
        <label class="small">Question List</label>
        <div class="q-list" id="qList"></div>
        <button id="addQuestion" class="addBtn" style="margin-top:4px">Add Question</button>
      </div>
      <div class="col">
        <label class="small">Question Prompt</label>
        <textarea id="editPrompt" rows="4" placeholder="Enter question..."></textarea>
        <label class="small">Correct Answer (hidden from students)</label>
        <input id="editAnswer" type="text" placeholder="Enter answer...">
        <div class="editor-actions">
          <button id="saveQuestion" type="button">Save Question</button>
          <button id="closeEditor" type="button" class="secondary">Close</button>
          <button id="deleteQuestion" type="button" class="secondary" style="background:#ffe9e9;color:#c03636">Delete</button>
        </div>
        <div class="status" id="editStatus"></div>
      </div>
    </div>
  </div>
</div>

<script>
/* ========= DATA & STATE ========= */
const LS_KEY='sa_quiz_v1';
let questions=[
  {prompt:'Name the largest planet in our solar system.', answer:'Jupiter'},
  {prompt:'What is the process by which plants make food?', answer:'Photosynthesis'},
  {prompt:'Abbreviation of World Wide Web?', answer:'WWW'}
];
try{
  const saved=JSON.parse(localStorage.getItem(LS_KEY)||'null');
  if(Array.isArray(saved) && saved.every(q=>q && typeof q.prompt==='string' && typeof q.answer==='string')){
    questions=saved;
  }
}catch(e){}
let current=0;
let userAnswers=new Array(questions.length).fill('');

/* ========= ELEMENTS ========= */
const questionText=qs('#questionText');
const answerInput=qs('#answerInput');
const nextBtn=qs('#nextBtn');
const finishBtn=qs('#finishBtn');
const bar=qs('#bar');

function qs(s){return document.querySelector(s);}

/* ========= RENDER ========= */
function renderQuestion(){
  const q=questions[current];
  if(!q) return;
  questionText.textContent=q.prompt;
  answerInput.value=userAnswers[current]||'';
  answerInput.disabled=false;
  answerInput.focus();
  updateNav();
  updateBar();
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}

answerInput.addEventListener('input',updateNav);
answerInput.addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    if(current < questions.length-1 && answerInput.value.trim()){
      saveCurrentAnswer();
      current++;
      renderQuestion();
    } else if(current===questions.length-1 && answerInput.value.trim()){
      saveCurrentAnswer();
      finishQuiz();
    }
  }
});

function saveCurrentAnswer(){
  userAnswers[current]=answerInput.value.trim();
}

function updateNav(){
  const answered = !!answerInput.value.trim();
  const isLast = current === questions.length - 1;

  // Clear previous states
  nextBtn.classList.remove('active');
  finishBtn.classList.remove('active');

  if(!answered){
    return; // both stay hidden but space reserved
  }
  if(!isLast){
    nextBtn.classList.add('active');
  } else {
    finishBtn.classList.add('active');
  }
}
function updateBar(){
  const pct=((current)/Math.max(questions.length-1,1))*100;
  bar.style.width=pct+'%';
}

/* ========= NAV EVENTS ========= */
nextBtn.addEventListener('click',()=>{
  if(!answerInput.value.trim()) return;
  saveCurrentAnswer();
  current++; renderQuestion();
});
finishBtn.addEventListener('click',()=>{
  if(!answerInput.value.trim()) return;
  saveCurrentAnswer();
  finishQuiz();
});

/* ========= FINAL MODAL ========= */
const finalModal=qs('#finalModal');
const finalMsg=qs('#finalMsg');
qs('#restartBtn').addEventListener('click',()=>{
  closeFinal();
  current=0;
  userAnswers=new Array(questions.length).fill('');
  renderQuestion();
});
function finishQuiz(){
  answerInput.disabled=true;
  openFinal();
}
function openFinal(){
  finalMsg.textContent='You answered '+userAnswers.filter(v=>v).length+' question'+(questions.length===1?'':'s')+'.';
  finalModal.style.display='flex';
  finalModal.setAttribute('aria-hidden','false');
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}
function closeFinal(){
  finalModal.style.display='none';
  finalModal.setAttribute('aria-hidden','true');
}

/* ========= EDITOR ========= */
const editorModal=qs('#editorModal');
const qList=qs('#qList');
const editPrompt=qs('#editPrompt');
const editAnswer=qs('#editAnswer');
const editStatus=qs('#editStatus');
const addQuestionBtn=qs('#addQuestion');
const saveQuestionBtn=qs('#saveQuestion');
const deleteQuestionBtn=qs('#deleteQuestion');
const closeEditorBtn=qs('#closeEditor');
let editingIndex=0;

qs('#editOpen').addEventListener('click',openEditor);
closeEditorBtn.addEventListener('click',closeEditor);
addQuestionBtn.addEventListener('click',addQuestion);
saveQuestionBtn.addEventListener('click',saveEditingQuestion);
deleteQuestionBtn.addEventListener('click',deleteEditingQuestion);

function openEditor(){
  buildQList();
  loadEditingQuestion(editingIndex);
  editStatus.textContent='';
  editorModal.style.display='flex';
  editorModal.setAttribute('aria-hidden','false');
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}
function closeEditor(){
  editorModal.style.display='none';
  editorModal.setAttribute('aria-hidden','true');
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}
function buildQList(){
  qList.innerHTML='';
  questions.forEach((q,i)=>{
    const r=document.createElement('div');
    r.className='qrow'+(i===editingIndex?' active':'');
    r.innerHTML='<div style="font-size:.8rem;font-weight:600;color:#38546a">'+(i+1)+'. '+escapeHtml(q.prompt.slice(0,60))+'</div><div class="inline"></div>';
    const btn=document.createElement('button');
    btn.textContent='Edit';
    btn.addEventListener('click',()=>{editingIndex=i;buildQList();loadEditingQuestion(i);});
    r.querySelector('.inline').appendChild(btn);
    qList.appendChild(r);
  });
}
function loadEditingQuestion(i){
  const q=questions[i]; if(!q) return;
  editPrompt.value=q.prompt;
  editAnswer.value=q.answer;
}
function saveEditingQuestion(){
  const prompt=editPrompt.value.trim();
  const answer=editAnswer.value.trim();
  if(!prompt){status('Enter a question',true);return;}
  if(!answer){status('Enter an answer',true);return;}
  questions[editingIndex]={prompt,answer};
  persist();
  status('Saved');
  buildQList();
  current=0; userAnswers=new Array(questions.length).fill('');
  renderQuestion();
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}
function deleteEditingQuestion(){
  if(!questions.length) return;
  if(!confirm('Delete this question?')) return;
  questions.splice(editingIndex,1);
  if(!questions.length){
    questions.push({prompt:'New question',answer:'Answer'});
  }
  editingIndex=Math.min(editingIndex,questions.length-1);
  persist();
  buildQList();
  loadEditingQuestion(editingIndex);
  current=0; userAnswers=new Array(questions.length).fill('');
  renderQuestion();
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}
function addQuestion(){
  questions.push({prompt:'New question',answer:'Answer'});
  editingIndex=questions.length-1;
  persist();
  buildQList();
  loadEditingQuestion(editingIndex);
  if(window.__quizFit) setTimeout(window.__quizFit,0);
}
function status(msg,err){
  editStatus.textContent=msg;
  editStatus.style.color= err? 'var(--danger)':'var(--accent)';
}
function persist(){
  localStorage.setItem(LS_KEY, JSON.stringify(questions));
}

/* ========= UTIL ========= */
function escapeHtml(s){return s.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}

/* ========= SCALING (FIT TO CANVAS) ========= */
(function(){
  const root=document.getElementById('embedRoot');
  const scaleWrap=document.querySelector('.quiz-scale');
  const quiz=document.querySelector('.quiz-wrap');
  if(!root||!scaleWrap||!quiz) return;

  function naturalHeight(){
    const prev=scaleWrap.style.transform;
    scaleWrap.style.transform='none';
    const h=quiz.offsetHeight;
    scaleWrap.style.transform=prev;
    return h;
  }
  function fit(){
    const w=quiz.offsetWidth;          // design width (640px)
    const h=naturalHeight();
    const rw=root.clientWidth;
    const rh=root.clientHeight;
    const scale=Math.min(rw/w, rh/h);
    scaleWrap.style.transform=`scale(${scale})`;
  }
  new ResizeObserver(fit).observe(root);
  window.addEventListener('orientationchange',fit);
  window.addEventListener('load',fit);
  window.__quizFit=fit;
  setTimeout(fit,40);
})();

/* ========= INIT ========= */
renderQuestion();
</script>
</body>
</html>